<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/.dockerignore">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/.dockerignore" />
              <option name="updatedContent" value="target/&#10;!target/*.jar&#10;.mvn/wrapper/maven-wrapper.jar&#10;.git&#10;.gitignore&#10;README.md&#10;Dockerfile&#10;.dockerignore" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/API.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/API.md" />
              <option name="updatedContent" value="# API Documentation&#10;&#10;## Authentication&#10;&#10;All API endpoints require authentication. Use the following credentials:&#10;&#10;- **Username**: admin&#10;- **Password**: admin123&#10;&#10;## Base URL&#10;&#10;```&#10;http://localhost:8080/api&#10;```&#10;&#10;## Courier Endpoints&#10;&#10;### Get All Couriers&#10;```http&#10;GET /api/couriers&#10;```&#10;&#10;**Response:**&#10;```json&#10;[&#10;  {&#10;    &quot;id&quot;: 1,&#10;    &quot;name&quot;: &quot;Ali Özkan&quot;,&#10;    &quot;email&quot;: &quot;ali.ozkan@courier.com&quot;,&#10;    &quot;phone&quot;: &quot;+905551111111&quot;,&#10;    &quot;vehicleType&quot;: &quot;MOTORCYCLE&quot;,&#10;    &quot;workType&quot;: &quot;SHIFT&quot;,&#10;    &quot;isAvailable&quot;: true,&#10;    &quot;status&quot;: &quot;ONLINE&quot;&#10;  }&#10;]&#10;```&#10;&#10;### Get Courier by ID&#10;```http&#10;GET /api/couriers/{id}&#10;```&#10;&#10;### Create New Courier&#10;```http&#10;POST /api/couriers&#10;Content-Type: application/json&#10;&#10;{&#10;  &quot;name&quot;: &quot;John Doe&quot;,&#10;  &quot;email&quot;: &quot;john.doe@courier.com&quot;,&#10;  &quot;phone&quot;: &quot;+905551234567&quot;,&#10;  &quot;vehicleType&quot;: &quot;MOTORCYCLE&quot;,&#10;  &quot;workType&quot;: &quot;SHIFT&quot;,&#10;  &quot;isAvailable&quot;: true&#10;}&#10;```&#10;&#10;### Update Courier&#10;```http&#10;PUT /api/couriers/{id}&#10;Content-Type: application/json&#10;&#10;{&#10;  &quot;name&quot;: &quot;John Doe Updated&quot;,&#10;  &quot;email&quot;: &quot;john.doe@courier.com&quot;,&#10;  &quot;phone&quot;: &quot;+905551234567&quot;,&#10;  &quot;isAvailable&quot;: false&#10;}&#10;```&#10;&#10;### Delete Courier&#10;```http&#10;DELETE /api/couriers/{id}&#10;```&#10;&#10;### Get Available Couriers&#10;```http&#10;GET /api/couriers/available&#10;```&#10;&#10;### Search Couriers&#10;```http&#10;GET /api/couriers/search?name=Ali&#10;```&#10;&#10;## Error Responses&#10;&#10;### Validation Error (400)&#10;```json&#10;{&#10;  &quot;timestamp&quot;: &quot;2025-08-04T12:00:00&quot;,&#10;  &quot;status&quot;: 400,&#10;  &quot;error&quot;: &quot;Validation Failed&quot;,&#10;  &quot;errors&quot;: {&#10;    &quot;name&quot;: &quot;Name is required&quot;,&#10;    &quot;email&quot;: &quot;Email should be valid&quot;&#10;  }&#10;}&#10;```&#10;&#10;### Not Found (404)&#10;```json&#10;{&#10;  &quot;timestamp&quot;: &quot;2025-08-04T12:00:00&quot;,&#10;  &quot;status&quot;: 404,&#10;  &quot;error&quot;: &quot;Courier not found&quot;,&#10;  &quot;message&quot;: &quot;Courier with id 999 not found&quot;&#10;}&#10;```&#10;&#10;### Internal Server Error (500)&#10;```json&#10;{&#10;  &quot;timestamp&quot;: &quot;2025-08-04T12:00:00&quot;,&#10;  &quot;status&quot;: 500,&#10;  &quot;error&quot;: &quot;Internal Server Error&quot;,&#10;  &quot;message&quot;: &quot;An unexpected error occurred&quot;&#10;}&#10;```&#10;&#10;## Health Check Endpoints&#10;&#10;### Application Health&#10;```http&#10;GET /actuator/health&#10;```&#10;&#10;**Response:**&#10;```json&#10;{&#10;  &quot;status&quot;: &quot;UP&quot;,&#10;  &quot;components&quot;: {&#10;    &quot;db&quot;: {&#10;      &quot;status&quot;: &quot;UP&quot;,&#10;      &quot;details&quot;: {&#10;        &quot;database&quot;: &quot;MySQL&quot;,&#10;        &quot;validationQuery&quot;: &quot;isValid()&quot;&#10;      }&#10;    },&#10;    &quot;redis&quot;: {&#10;      &quot;status&quot;: &quot;UP&quot;&#10;    }&#10;  }&#10;}&#10;```&#10;&#10;### Application Info&#10;```http&#10;GET /actuator/info&#10;```&#10;&#10;### Application Metrics&#10;```http&#10;GET /actuator/metrics&#10;```" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/DATABASE.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/DATABASE.md" />
              <option name="updatedContent" value="# Database Schema Documentation&#10;&#10;## Overview&#10;&#10;The I Need Courier system uses a MySQL database with the following core entities designed for B2B courier operations.&#10;&#10;## Entity Relationship Diagram&#10;&#10;```&#10;SystemUser (1) ←→ (1) Coordinator (1) ←→ (N) Courier&#10;                         ↓                    ↓&#10;Business (1) ←→ (N) Order ←→ (1) Courier ←→ (1) Vehicle&#10;                    ↓&#10;              OrderTracking (N)&#10;```&#10;&#10;## Tables&#10;&#10;### system_users&#10;System users including admins, coordinators, and couriers.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| username | VARCHAR(50) | UNIQUE, NOT NULL | Login username |&#10;| email | VARCHAR(100) | UNIQUE, NOT NULL | Email address |&#10;| password | VARCHAR(255) | NOT NULL | Encrypted password |&#10;| first_name | VARCHAR(50) | | First name |&#10;| last_name | VARCHAR(50) | | Last name |&#10;| phone | VARCHAR(20) | | Phone number |&#10;| role | ENUM | NOT NULL | ADMIN, COORDINATOR, COURIER |&#10;| is_active | BOOLEAN | DEFAULT TRUE | Account status |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Creation time |&#10;| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Last update time |&#10;&#10;**Indexes:**&#10;- `idx_email (email)`&#10;- `idx_username (username)`&#10;- `idx_role (role)`&#10;- `idx_is_active (is_active)`&#10;&#10;### businesses&#10;Companies that place delivery orders.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| business_code | VARCHAR(50) | UNIQUE, NOT NULL | Business code |&#10;| name | VARCHAR(200) | NOT NULL | Business name |&#10;| contact_person | VARCHAR(100) | | Contact person name |&#10;| phone | VARCHAR(20) | NOT NULL | Phone number |&#10;| email | VARCHAR(100) | | Email address |&#10;| address | VARCHAR(500) | NOT NULL | Business address |&#10;| address_description | TEXT | | Detailed address description |&#10;| latitude | DECIMAL(10,8) | | GPS latitude |&#10;| longitude | DECIMAL(11,8) | | GPS longitude |&#10;| location_name | VARCHAR(200) | | Location name |&#10;| business_type | VARCHAR(100) | | Type of business |&#10;| payment_terms | ENUM | DEFAULT 'POSTPAID' | PREPAID, POSTPAID, CASH_ON_DELIVERY |&#10;| credit_limit | DECIMAL(10,2) | DEFAULT 0.00 | Credit limit |&#10;| is_active | BOOLEAN | DEFAULT TRUE | Business status |&#10;| notes | TEXT | | Additional notes |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Creation time |&#10;| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Last update time |&#10;&#10;**Indexes:**&#10;- `idx_business_code (business_code)`&#10;- `idx_name (name)`&#10;- `idx_phone (phone)`&#10;- `idx_business_type (business_type)`&#10;- `idx_is_active (is_active)`&#10;- `idx_location (latitude, longitude)`&#10;&#10;### coordinators&#10;Field coordinators who manage courier teams.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| system_user_id | BIGINT | UNIQUE, FK → system_users.id | Associated system user |&#10;| name | VARCHAR(100) | NOT NULL | Coordinator name |&#10;| email | VARCHAR(100) | UNIQUE, NOT NULL | Email address |&#10;| phone | VARCHAR(20) | NOT NULL | Phone number |&#10;| employee_id | VARCHAR(50) | UNIQUE | Employee identifier |&#10;| work_type | ENUM | DEFAULT 'SHIFT' | JOKER, SHIFT |&#10;| shift_start | TIME | | Shift start time |&#10;| shift_end | TIME | | Shift end time |&#10;| is_active | BOOLEAN | DEFAULT TRUE | Active status |&#10;| status | ENUM | DEFAULT 'OFFLINE' | ONLINE, OFFLINE, BUSY, ON_BREAK, IN_FIELD |&#10;| current_latitude | DECIMAL(10,8) | | Current GPS latitude |&#10;| current_longitude | DECIMAL(11,8) | | Current GPS longitude |&#10;| coverage_area | VARCHAR(500) | | Responsible coverage area |&#10;| max_courier_count | INT | DEFAULT 10 | Maximum couriers managed |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Creation time |&#10;| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Last update time |&#10;&#10;### couriers&#10;Delivery personnel who execute orders.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| system_user_id | BIGINT | UNIQUE, FK → system_users.id | Associated system user |&#10;| name | VARCHAR(100) | NOT NULL | Courier name |&#10;| email | VARCHAR(100) | UNIQUE, NOT NULL | Email address |&#10;| phone | VARCHAR(20) | NOT NULL | Phone number |&#10;| license_number | VARCHAR(50) | | Driving license number |&#10;| vehicle_type | ENUM | | BICYCLE, MOTORCYCLE, CAR, VAN, TRUCK, WALKING |&#10;| work_type | ENUM | DEFAULT 'SHIFT' | JOKER, SHIFT |&#10;| shift_start | TIME | | Shift start time |&#10;| shift_end | TIME | | Shift end time |&#10;| is_available | BOOLEAN | DEFAULT TRUE | Availability status |&#10;| status | ENUM | DEFAULT 'OFFLINE' | ONLINE, OFFLINE, BUSY, ON_BREAK, IN_DELIVERY |&#10;| current_latitude | DECIMAL(10,8) | | Current GPS latitude |&#10;| current_longitude | DECIMAL(11,8) | | Current GPS longitude |&#10;| current_location_name | VARCHAR(200) | | Current location name |&#10;| total_deliveries | INT | DEFAULT 0 | Total completed deliveries |&#10;| vehicle_id | BIGINT | FK → vehicles.id | Assigned vehicle |&#10;| coordinator_id | BIGINT | FK → coordinators.id | Assigned coordinator |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Creation time |&#10;| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Last update time |&#10;&#10;### orders&#10;Delivery orders from businesses to end customers.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| order_number | VARCHAR(50) | UNIQUE, NOT NULL | Order reference number |&#10;| status | ENUM | DEFAULT 'PENDING' | PENDING, ASSIGNED, PICKED_UP, IN_TRANSIT, DELIVERED, CANCELLED |&#10;| priority | ENUM | DEFAULT 'NORMAL' | LOW, NORMAL, HIGH, URGENT |&#10;| business_id | BIGINT | NOT NULL, FK → businesses.id | Ordering business |&#10;| courier_id | BIGINT | FK → couriers.id | Assigned courier |&#10;| coordinator_id | BIGINT | FK → coordinators.id | Supervising coordinator |&#10;| end_customer_name | VARCHAR(100) | NOT NULL | Final recipient name |&#10;| end_customer_phone | VARCHAR(20) | | Final recipient phone |&#10;| pickup_address | TEXT | NOT NULL | Pickup location |&#10;| pickup_address_description | TEXT | | Detailed pickup instructions |&#10;| delivery_address | TEXT | NOT NULL | Delivery location |&#10;| delivery_address_description | TEXT | | Detailed delivery instructions |&#10;| package_description | VARCHAR(500) | NOT NULL | Package contents |&#10;| package_weight | DECIMAL(8,2) | | Package weight (kg) |&#10;| package_count | INT | DEFAULT 1 | Number of packages |&#10;| package_value | DECIMAL(10,2) | | Package value for insurance |&#10;| payment_type | ENUM | DEFAULT 'BUSINESS_ACCOUNT' | CASH, CARD, ONLINE, BUSINESS_ACCOUNT |&#10;| delivery_fee | DECIMAL(10,2) | NOT NULL | Delivery charge |&#10;| collection_amount | DECIMAL(10,2) | DEFAULT 0.00 | Amount to collect |&#10;| courier_notes | TEXT | | Instructions for courier |&#10;| business_notes | TEXT | | Notes from business |&#10;| receipt_image_url | VARCHAR(500) | | Receipt/invoice image |&#10;| delivery_proof_url | VARCHAR(500) | | Delivery confirmation image |&#10;| order_date | DATETIME | DEFAULT CURRENT_TIMESTAMP | Order creation date |&#10;| scheduled_pickup_time | DATETIME | | Planned pickup time |&#10;| actual_pickup_time | DATETIME | | Actual pickup time |&#10;| estimated_delivery_time | DATETIME | | Estimated delivery time |&#10;| actual_delivery_time | DATETIME | | Actual delivery time |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Creation time |&#10;| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Last update time |&#10;&#10;### vehicles&#10;Courier vehicles and equipment.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| plate_number | VARCHAR(20) | UNIQUE, NOT NULL | License plate |&#10;| vehicle_type | ENUM | NOT NULL | BICYCLE, MOTORCYCLE, CAR, VAN, TRUCK, WALKING |&#10;| brand | VARCHAR(50) | | Vehicle brand |&#10;| model | VARCHAR(50) | | Vehicle model |&#10;| year | INT | | Manufacturing year |&#10;| color | VARCHAR(30) | | Vehicle color |&#10;| max_weight_capacity | DECIMAL(8,2) | | Maximum load capacity (kg) |&#10;| is_active | BOOLEAN | DEFAULT TRUE | Vehicle status |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Creation time |&#10;| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE | Last update time |&#10;&#10;### order_tracking&#10;Order status change history and tracking.&#10;&#10;| Column | Type | Constraints | Description |&#10;|--------|------|-------------|-------------|&#10;| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | Unique identifier |&#10;| order_id | BIGINT | NOT NULL, FK → orders.id | Associated order |&#10;| status | ENUM | NOT NULL | Order status at this point |&#10;| description | VARCHAR(500) | | Status change description |&#10;| location | VARCHAR(200) | | Location name |&#10;| latitude | DECIMAL(10,8) | | GPS latitude |&#10;| longitude | DECIMAL(11,8) | | GPS longitude |&#10;| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | Timestamp |&#10;| created_by | VARCHAR(100) | | Person who made the change |&#10;| created_by_type | ENUM | DEFAULT 'SYSTEM' | SYSTEM, COURIER, COORDINATOR, ADMIN |&#10;&#10;## Relationships&#10;&#10;- **system_users** → **coordinators** (1:1)&#10;- **system_users** → **couriers** (1:1)&#10;- **coordinators** → **couriers** (1:N)&#10;- **businesses** → **orders** (1:N)&#10;- **couriers** → **orders** (1:N)&#10;- **vehicles** → **couriers** (1:1)&#10;- **orders** → **order_tracking** (1:N)&#10;&#10;## Indexes and Performance&#10;&#10;### Query Optimization&#10;- **Location-based queries**: Spatial indexes on latitude/longitude columns&#10;- **Status filtering**: Indexes on status and priority columns&#10;- **Time-based queries**: Indexes on timestamp columns&#10;- **Search functionality**: Indexes on name and email columns&#10;&#10;### Performance Considerations&#10;- **Partitioning**: Consider partitioning orders table by date for large datasets&#10;- **Archiving**: Move old orders to archive tables&#10;- **Caching**: Use Redis for frequently accessed data like active orders and courier locations" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/DEPLOYMENT.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/DEPLOYMENT.md" />
              <option name="updatedContent" value="# Deployment Guide&#10;&#10;## Prerequisites&#10;&#10;- Docker 20.10+&#10;- Docker Compose 2.0+&#10;- Git&#10;&#10;## Quick Start&#10;&#10;### 1. Clone Repository&#10;```bash&#10;git clone https://github.com/Yasin4261/i-need-courier.git&#10;cd i-need-courier&#10;```&#10;&#10;### 2. Environment Setup&#10;The application uses Docker Compose with predefined environment variables. No additional configuration is required for development.&#10;&#10;### 3. Start Services&#10;```bash&#10;# Build and start all services&#10;docker-compose up --build -d&#10;&#10;# Check service status&#10;docker-compose ps&#10;&#10;# View logs&#10;docker-compose logs -f web-app&#10;```&#10;&#10;### 4. Access Application&#10;- **Web Interface**: http://localhost&#10;- **API**: http://localhost:8080&#10;- **Health Check**: http://localhost/health&#10;&#10;## Service Architecture&#10;&#10;```mermaid&#10;graph TB&#10;    A[Nginx :80] --&gt; B[Spring Boot :8080]&#10;    B --&gt; C[MySQL :3306]&#10;    B --&gt; D[Redis :6379]&#10;    B --&gt; E[Kafka :9092]&#10;    E --&gt; F[Zookeeper :2181]&#10;```&#10;&#10;## Environment Configuration&#10;&#10;### Development&#10;```yaml&#10;# docker-compose.yml&#10;services:&#10;  web-app:&#10;    environment:&#10;      SPRING_PROFILES_ACTIVE: docker&#10;      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/courier_db&#10;      SPRING_REDIS_HOST: redis&#10;      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092&#10;```&#10;&#10;### Production Recommendations&#10;&#10;1. **Security**&#10;   - Change default passwords&#10;   - Use environment-specific secrets&#10;   - Enable SSL/TLS&#10;&#10;2. **Database**&#10;   - Use external managed MySQL instance&#10;   - Configure backup strategies&#10;   - Optimize connection pooling&#10;&#10;3. **Caching**&#10;   - Use Redis cluster for high availability&#10;   - Configure appropriate memory limits&#10;&#10;4. **Monitoring**&#10;   - Enable application metrics&#10;   - Configure log aggregation&#10;   - Set up health check monitoring&#10;&#10;## Scaling Considerations&#10;&#10;### Horizontal Scaling&#10;```yaml&#10;services:&#10;  web-app:&#10;    deploy:&#10;      replicas: 3&#10;    depends_on:&#10;      - mysql&#10;      - redis&#10;```&#10;&#10;### Load Balancing&#10;Nginx is configured to handle load balancing across multiple application instances.&#10;&#10;## Troubleshooting&#10;&#10;### Common Issues&#10;&#10;**Database Connection Failed**&#10;```bash&#10;# Check MySQL container&#10;docker-compose logs mysql&#10;&#10;# Verify database credentials&#10;docker-compose exec mysql mysql -u courier_user -p courier_db&#10;```&#10;&#10;**Application Won't Start**&#10;```bash&#10;# Check application logs&#10;docker-compose logs web-app&#10;&#10;# Restart specific service&#10;docker-compose restart web-app&#10;```&#10;&#10;**Port Conflicts**&#10;```bash&#10;# Check port usage&#10;netstat -tulpn | grep :80&#10;&#10;# Stop conflicting services&#10;sudo service apache2 stop&#10;```&#10;&#10;### Health Checks&#10;&#10;```bash&#10;# Application health&#10;curl http://localhost/health&#10;&#10;# Database connectivity&#10;curl http://localhost:8080/actuator/health&#10;&#10;# Service status&#10;docker-compose ps&#10;```&#10;&#10;## Backup &amp; Recovery&#10;&#10;### Database Backup&#10;```bash&#10;# Create backup&#10;docker-compose exec mysql mysqldump -u courier_user -p courier_db &gt; backup.sql&#10;&#10;# Restore backup&#10;docker-compose exec -i mysql mysql -u courier_user -p courier_db &lt; backup.sql&#10;```&#10;&#10;### Volume Backup&#10;```bash&#10;# Backup volumes&#10;docker run --rm -v courier_mysql_data:/data -v $(pwd):/backup alpine tar czf /backup/mysql_backup.tar.gz /data&#10;```&#10;&#10;## Monitoring&#10;&#10;### Application Metrics&#10;- `/actuator/health` - Health status&#10;- `/actuator/metrics` - Performance metrics&#10;- `/actuator/info` - Application information&#10;&#10;### Container Monitoring&#10;```bash&#10;# Resource usage&#10;docker stats&#10;&#10;# Container logs&#10;docker-compose logs -f [service-name]&#10;```" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/Dockerfile">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/Dockerfile" />
              <option name="originalContent" value="# Multi-stage build for Spring Boot application&#10;FROM openjdk:21-jdk-slim AS builder&#10;&#10;WORKDIR /app&#10;COPY mvnw .&#10;COPY .mvn .mvn&#10;COPY pom.xml .&#10;COPY src src&#10;&#10;# Make mvnw executable&#10;RUN chmod +x ./mvnw&#10;&#10;# Build the application&#10;RUN ./mvnw clean package -DskipTests&#10;&#10;# Runtime stage&#10;FROM openjdk:21-jre-slim&#10;&#10;WORKDIR /app&#10;&#10;# Copy the built JAR from builder stage&#10;COPY --from=builder /app/target/*.jar app.jar&#10;&#10;# Create non-root user&#10;RUN addgroup --system spring &amp;&amp; adduser --system spring --ingroup spring&#10;USER spring:spring&#10;&#10;EXPOSE 8080&#10;&#10;ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]&#10;" />
              <option name="updatedContent" value="# Multi-stage build for Spring Boot application&#10;FROM eclipse-temurin:21-jdk-alpine AS builder&#10;&#10;WORKDIR /app&#10;COPY mvnw .&#10;COPY .mvn .mvn&#10;COPY pom.xml .&#10;COPY src src&#10;&#10;# Make mvnw executable&#10;RUN chmod +x ./mvnw&#10;&#10;# Build the application&#10;RUN ./mvnw clean package -DskipTests&#10;&#10;# Runtime stage&#10;FROM eclipse-temurin:21-jre-alpine&#10;&#10;WORKDIR /app&#10;&#10;# Copy the built JAR from builder stage&#10;COPY --from=builder /app/target/*.jar app.jar&#10;&#10;# Create non-root user&#10;RUN addgroup -S spring &amp;&amp; adduser -S spring -G spring&#10;USER spring:spring&#10;&#10;EXPOSE 8080&#10;&#10;ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;]" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/LICENSE">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/LICENSE" />
              <option name="updatedContent" value="MIT License&#10;&#10;Copyright (c) 2025 Yasin Güneş&#10;&#10;Permission is hereby granted, free of charge, to any person obtaining a copy&#10;of this software and associated documentation files (the &quot;Software&quot;), to deal&#10;in the Software without restriction, including without limitation the rights&#10;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#10;copies of the Software, and to permit persons to whom the Software is&#10;furnished to do so, subject to the following conditions:&#10;&#10;The above copyright notice and this permission notice shall be included in all&#10;copies or substantial portions of the Software.&#10;&#10;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#10;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#10;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#10;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#10;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#10;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE&#10;SOFTWARE." />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/README.md" />
              <option name="updatedContent" value="# I Need Courier - B2B Courier Management System&#10;&#10;A comprehensive B2B courier management system built with Spring Boot, designed for businesses to manage courier operations efficiently.&#10;&#10;##  Features&#10;&#10;- **Business Management**: Register and manage businesses that place orders&#10;- **Courier Management**: Manage courier staff with shift scheduling and vehicle assignment&#10;- **Coordinator System**: Field coordinators supervise couriers and assign orders&#10;- **Order Tracking**: Real-time order tracking with GPS coordinates&#10;- **Vehicle Management**: Assign and track courier vehicles&#10;- **Flexible Work Types**: Support for both shift-based and flexible (joker) work schedules&#10;- **Payment System**: Multiple payment types including business accounts and cash collection&#10;&#10;## ️ Architecture&#10;&#10;### Tech Stack&#10;- **Backend**: Spring Boot 3.5.4 with Java 21&#10;- **Database**: MySQL 8.0 with Flyway migrations&#10;- **Cache**: Redis for session management&#10;- **Message Queue**: Apache Kafka&#10;- **Security**: Spring Security&#10;- **Containerization**: Docker &amp; Docker Compose&#10;- **Reverse Proxy**: Nginx&#10;&#10;### System Design&#10;The system follows a B2B model where:&#10;1. **Businesses** place orders in the system&#10;2. **Coordinators** assign orders to available couriers&#10;3. **Couriers** pick up packages from businesses and deliver to end customers&#10;4. **Real-time tracking** throughout the delivery process&#10;&#10;## ️ Database Schema&#10;&#10;### Core Entities&#10;&#10;#### System Users&#10;- Admins, Coordinators, and Couriers with role-based access&#10;- Secure authentication and authorization&#10;&#10;#### Businesses&#10;- Companies that place delivery orders&#10;- Contact information and address details&#10;- Payment terms and credit limits&#10;&#10;#### Orders&#10;- Complete order lifecycle management&#10;- Pickup and delivery addresses with detailed descriptions&#10;- Package information including weight and value&#10;- Payment and collection details&#10;&#10;#### Couriers&#10;- Personal and professional information&#10;- Shift scheduling (fixed shifts or flexible hours)&#10;- Vehicle assignments and current location&#10;- Performance tracking&#10;&#10;#### Coordinators&#10;- Field supervisors managing courier teams&#10;- Coverage area assignments&#10;- Capacity management&#10;&#10;##  Deployment&#10;&#10;### Using Docker Compose&#10;&#10;1. **Clone the repository**&#10;```bash&#10;git clone https://github.com/Yasin4261/i-need-courier.git&#10;cd i-need-courier&#10;```&#10;&#10;2. **Start all services**&#10;```bash&#10;docker-compose up --build -d&#10;```&#10;&#10;3. **Access the application**&#10;- Main Application: http://localhost&#10;- Direct API: http://localhost:8080&#10;- Health Check: http://localhost/health&#10;&#10;### Services Overview&#10;&#10;| Service | Port | Description |&#10;|---------|------|-------------|&#10;| Nginx | 80 | Reverse proxy and load balancer |&#10;| Spring Boot App | 8080 | Main application server |&#10;| MySQL | 3306 | Primary database |&#10;| Redis | 6379 | Session store and cache |&#10;| Kafka | 9092 | Message broker |&#10;&#10;##  Authentication&#10;&#10;### Default Login&#10;- **Username**: admin&#10;- **Password**: admin123&#10;&#10;### User Roles&#10;- **ADMIN**: Full system access&#10;- **COORDINATOR**: Manage couriers and assign orders&#10;- **COURIER**: View assigned orders and update status&#10;&#10;##  Sample Data&#10;&#10;The system comes with pre-loaded sample data:&#10;- 1 System Admin&#10;- 2 Coordinators (different shifts and coverage areas)&#10;- 3 Couriers with various vehicle types&#10;- 5 Businesses (restaurants, pharmacies, markets)&#10;- Sample orders in different states&#10;&#10;## ️ Development&#10;&#10;### Prerequisites&#10;- Java 21+&#10;- Maven 3.6+&#10;- Docker &amp; Docker Compose&#10;&#10;### Local Development Setup&#10;&#10;1. **Database Setup**&#10;```bash&#10;# Using Docker&#10;docker run -d --name courier-mysql \&#10;  -e MYSQL_ROOT_PASSWORD=root_password \&#10;  -e MYSQL_DATABASE=courier_db \&#10;  -e MYSQL_USER=courier_user \&#10;  -e MYSQL_PASSWORD=courier_password \&#10;  -p 3306:3306 mysql:8.0&#10;```&#10;&#10;2. **Redis Setup**&#10;```bash&#10;docker run -d --name courier-redis -p 6379:6379 redis:7-alpine&#10;```&#10;&#10;3. **Run Application**&#10;```bash&#10;./mvnw spring-boot:run&#10;```&#10;&#10;### Database Migrations&#10;&#10;The project uses Flyway for database migrations:&#10;- `V1__Create_initial_tables.sql`: Creates all database tables&#10;- `V2__Insert_initial_data.sql`: Loads sample data&#10;&#10;Migrations run automatically on application startup.&#10;&#10;##  API Endpoints&#10;&#10;### Courier Management&#10;- `GET /api/couriers` - List all couriers&#10;- `GET /api/couriers/{id}` - Get courier details&#10;- `POST /api/couriers` - Create new courier&#10;- `PUT /api/couriers/{id}` - Update courier&#10;- `DELETE /api/couriers/{id}` - Delete courier&#10;- `GET /api/couriers/available` - Get available couriers&#10;- `GET /api/couriers/search?name={name}` - Search couriers&#10;&#10;### Health Monitoring&#10;- `GET /actuator/health` - Application health status&#10;- `GET /actuator/info` - Application information&#10;- `GET /actuator/metrics` - Application metrics&#10;&#10;##  Business Flow&#10;&#10;### Order Lifecycle&#10;1. **Order Creation**: Business places an order in the system&#10;2. **Coordinator Assignment**: Order assigned to area coordinator&#10;3. **Courier Assignment**: Coordinator assigns order to available courier&#10;4. **Pickup**: Courier picks up package from business&#10;5. **In Transit**: Package being delivered to end customer&#10;6. **Delivery**: Package delivered and confirmed&#10;7. **Tracking**: Complete audit trail maintained&#10;&#10;### Work Schedule Types&#10;- **Shift Workers**: Fixed working hours with specific start/end times&#10;- **Joker Workers**: Flexible schedule, available as needed&#10;&#10;##  Error Handling&#10;&#10;The system includes comprehensive error handling:&#10;- Global exception handler for API errors&#10;- Validation errors with detailed field-level messages&#10;- Database constraint violations&#10;- Authentication and authorization errors&#10;&#10;##  Monitoring &amp; Observability&#10;&#10;- **Health Checks**: Built-in health monitoring&#10;- **Metrics**: Application performance metrics&#10;- **Logging**: Comprehensive logging throughout the application&#10;- **Database Monitoring**: Connection pool and query performance&#10;&#10;##  Contributing&#10;&#10;1. Fork the repository&#10;2. Create a feature branch (`git checkout -b feature/amazing-feature`)&#10;3. Commit your changes (`git commit -m 'Add some amazing feature'`)&#10;4. Push to the branch (`git push origin feature/amazing-feature`)&#10;5. Open a Pull Request&#10;&#10;##  License&#10;&#10;This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.&#10;&#10;## ‍♂️ Support&#10;&#10;For support and questions:&#10;- Create an issue in the GitHub repository&#10;- Check the existing documentation&#10;- Review the API endpoints and sample data&#10;&#10;##  Future Enhancements&#10;&#10;- [ ] Mobile application for couriers&#10;- [ ] Advanced analytics and reporting&#10;- [ ] Integration with mapping services&#10;- [ ] Automated dispatch algorithms&#10;- [ ] Customer notification system&#10;- [ ] Performance analytics dashboard" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/compose.yaml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/compose.yaml" />
              <option name="originalContent" value="services:&#10;  mysql:&#10;    image: 'mysql:latest'&#10;    environment:&#10;      - 'MYSQL_DATABASE=mydatabase'&#10;      - 'MYSQL_PASSWORD=secret'&#10;      - 'MYSQL_ROOT_PASSWORD=verysecret'&#10;      - 'MYSQL_USER=myuser'&#10;    ports:&#10;      - '3306'&#10;" />
              <option name="updatedContent" value="version: '3.8'&#10;&#10;services:&#10;  # MySQL Database&#10;  mysql:&#10;    image: mysql:8.0&#10;    container_name: courier-mysql&#10;    environment:&#10;      MYSQL_ROOT_PASSWORD: root_password&#10;      MYSQL_DATABASE: courier_db&#10;      MYSQL_USER: courier_user&#10;      MYSQL_PASSWORD: courier_password&#10;    ports:&#10;      - &quot;3306:3306&quot;&#10;    volumes:&#10;      - mysql_data:/var/lib/mysql&#10;    healthcheck:&#10;      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-h&quot;, &quot;localhost&quot;]&#10;      timeout: 20s&#10;      retries: 10&#10;    networks:&#10;      - courier-network&#10;&#10;  # Redis Cache&#10;  redis:&#10;    image: redis:7-alpine&#10;    container_name: courier-redis&#10;    ports:&#10;      - &quot;6379:6379&quot;&#10;    volumes:&#10;      - redis_data:/data&#10;    healthcheck:&#10;      test: [&quot;CMD&quot;, &quot;redis-cli&quot;, &quot;ping&quot;]&#10;      interval: 30s&#10;      timeout: 10s&#10;      retries: 3&#10;    networks:&#10;      - courier-network&#10;&#10;  # Kafka and Zookeeper&#10;  zookeeper:&#10;    image: confluentinc/cp-zookeeper:latest&#10;    container_name: courier-zookeeper&#10;    environment:&#10;      ZOOKEEPER_CLIENT_PORT: 2181&#10;      ZOOKEEPER_TICK_TIME: 2000&#10;    networks:&#10;      - courier-network&#10;&#10;  kafka:&#10;    image: confluentinc/cp-kafka:latest&#10;    container_name: courier-kafka&#10;    depends_on:&#10;      - zookeeper&#10;    ports:&#10;      - &quot;9092:9092&quot;&#10;    environment:&#10;      KAFKA_BROKER_ID: 1&#10;      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181&#10;      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092&#10;      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1&#10;    networks:&#10;      - courier-network&#10;&#10;  # Spring Boot Application&#10;  web-app:&#10;    build: .&#10;    container_name: courier-app&#10;    depends_on:&#10;      mysql:&#10;        condition: service_healthy&#10;      redis:&#10;        condition: service_healthy&#10;      kafka:&#10;        condition: service_started&#10;    ports:&#10;      - &quot;8080:8080&quot;&#10;    environment:&#10;      SPRING_PROFILES_ACTIVE: docker&#10;    networks:&#10;      - courier-network&#10;    restart: unless-stopped&#10;&#10;  # NGINX Reverse Proxy&#10;  nginx:&#10;    image: nginx:alpine&#10;    container_name: courier-nginx&#10;    depends_on:&#10;      - web-app&#10;    ports:&#10;      - &quot;80:80&quot;&#10;    volumes:&#10;      - ./nginx.conf:/etc/nginx/conf.d/default.conf&#10;    networks:&#10;      - courier-network&#10;    restart: unless-stopped&#10;&#10;volumes:&#10;  mysql_data:&#10;  redis_data:&#10;&#10;networks:&#10;  courier-network:&#10;    driver: bridge" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/nginx.conf">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/nginx.conf" />
              <option name="updatedContent" value="server {&#10;    listen 80;&#10;    server_name localhost;&#10;&#10;    # API endpoints&#10;    location /api/ {&#10;        proxy_pass http://web-app:8080/;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;        &#10;        # WebSocket support&#10;        proxy_http_version 1.1;&#10;        proxy_set_header Upgrade $http_upgrade;&#10;        proxy_set_header Connection &quot;upgrade&quot;;&#10;    }&#10;&#10;    # Health check endpoint&#10;    location /health {&#10;        proxy_pass http://web-app:8080/actuator/health;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;    }&#10;&#10;    # Static files (if any)&#10;    location /static/ {&#10;        proxy_pass http://web-app:8080/static/;&#10;    }&#10;&#10;    # Default location&#10;    location / {&#10;        proxy_pass http://web-app:8080/;&#10;        proxy_set_header Host $host;&#10;        proxy_set_header X-Real-IP $remote_addr;&#10;        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;&#10;        proxy_set_header X-Forwarded-Proto $scheme;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/pom.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/pom.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#10;&#9;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&#10;&#9;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&#10;&#9;&lt;parent&gt;&#10;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&#10;&#9;&#9;&lt;version&gt;3.5.4&lt;/version&gt;&#10;&#9;&#9;&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&#10;&#9;&lt;/parent&gt;&#10;&#9;&lt;groupId&gt;com.api&lt;/groupId&gt;&#10;&#9;&lt;artifactId&gt;demo&lt;/artifactId&gt;&#10;&#9;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&#10;&#9;&lt;name&gt;i-need-courier&lt;/name&gt;&#10;&#9;&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;&#10;&#9;&lt;url/&gt;&#10;&#9;&lt;licenses&gt;&#10;&#9;&#9;&lt;license/&gt;&#10;&#9;&lt;/licenses&gt;&#10;&#9;&lt;developers&gt;&#10;&#9;&#9;&lt;developer/&gt;&#10;&#9;&lt;/developers&gt;&#10;&#9;&lt;scm&gt;&#10;&#9;&#9;&lt;connection/&gt;&#10;&#9;&#9;&lt;developerConnection/&gt;&#10;&#9;&#9;&lt;tag/&gt;&#10;&#9;&#9;&lt;url/&gt;&#10;&#9;&lt;/scm&gt;&#10;&#9;&lt;properties&gt;&#10;&#9;&#9;&lt;java.version&gt;21&lt;/java.version&gt;&#10;&#9;&lt;/properties&gt;&#10;&#9;&lt;dependencies&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.session&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-docker-compose&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;runtime&lt;/scope&gt;&#10;&#9;&#9;&#9;&lt;optional&gt;true&lt;/optional&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;com.mysql&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;runtime&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;test&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-kafka-test&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;test&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;test&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&lt;/dependencies&gt;&#10;&#10;&#9;&lt;build&gt;&#10;&#9;&#9;&lt;plugins&gt;&#10;&#9;&#9;&#9;&lt;plugin&gt;&#10;&#9;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;/plugin&gt;&#10;&#9;&#9;&lt;/plugins&gt;&#10;&#9;&lt;/build&gt;&#10;&#10;&lt;/project&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#10;&#9;xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;&#10;&#9;&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;&#10;&#9;&lt;parent&gt;&#10;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&#10;&#9;&#9;&lt;version&gt;3.5.4&lt;/version&gt;&#10;&#9;&#9;&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&#10;&#9;&lt;/parent&gt;&#10;&#9;&lt;groupId&gt;com.api&lt;/groupId&gt;&#10;&#9;&lt;artifactId&gt;demo&lt;/artifactId&gt;&#10;&#9;&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;&#10;&#9;&lt;name&gt;i-need-courier&lt;/name&gt;&#10;&#9;&lt;description&gt;Demo project for Spring Boot&lt;/description&gt;&#10;&#9;&lt;url/&gt;&#10;&#9;&lt;licenses&gt;&#10;&#9;&#9;&lt;license/&gt;&#10;&#9;&lt;/licenses&gt;&#10;&#9;&lt;developers&gt;&#10;&#9;&#9;&lt;developer/&gt;&#10;&#9;&lt;/developers&gt;&#10;&#9;&lt;scm&gt;&#10;&#9;&#9;&lt;connection/&gt;&#10;&#9;&#9;&lt;developerConnection/&gt;&#10;&#9;&#9;&lt;tag/&gt;&#10;&#9;&#9;&lt;url/&gt;&#10;&#9;&lt;/scm&gt;&#10;&#9;&lt;properties&gt;&#10;&#9;&#9;&lt;java.version&gt;21&lt;/java.version&gt;&#10;&#9;&lt;/properties&gt;&#10;&#9;&lt;dependencies&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.session&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.flywaydb&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;flyway-core&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.flywaydb&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;flyway-mysql&lt;/artifactId&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-docker-compose&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;runtime&lt;/scope&gt;&#10;&#9;&#9;&#9;&lt;optional&gt;true&lt;/optional&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;com.mysql&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;runtime&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;test&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-kafka-test&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;test&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&#9;&lt;dependency&gt;&#10;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;&#10;&#9;&#9;&#9;&lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;scope&gt;test&lt;/scope&gt;&#10;&#9;&#9;&lt;/dependency&gt;&#10;&#9;&lt;/dependencies&gt;&#10;&#10;&#9;&lt;build&gt;&#10;&#9;&#9;&lt;plugins&gt;&#10;&#9;&#9;&#9;&lt;plugin&gt;&#10;&#9;&#9;&#9;&#9;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&#10;&#9;&#9;&#9;&#9;&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;&#10;&#9;&#9;&#9;&lt;/plugin&gt;&#10;&#9;&#9;&lt;/plugins&gt;&#10;&#9;&lt;/build&gt;&#10;&#10;&lt;/project&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/config/KafkaConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/config/KafkaConfig.java" />
              <option name="updatedContent" value="package com.api.demo.config;&#10;&#10;import org.apache.kafka.clients.producer.ProducerConfig;&#10;import org.apache.kafka.clients.consumer.ConsumerConfig;&#10;import org.apache.kafka.common.serialization.StringDeserializer;&#10;import org.apache.kafka.common.serialization.StringSerializer;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.kafka.config.ConcurrentKafkaListenerContainerFactory;&#10;import org.springframework.kafka.core.*;&#10;import org.springframework.kafka.support.serializer.JsonDeserializer;&#10;import org.springframework.kafka.support.serializer.JsonSerializer;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@Configuration&#10;public class KafkaConfig {&#10;&#10;    @Value(&quot;${spring.kafka.bootstrap-servers}&quot;)&#10;    private String bootstrapServers;&#10;&#10;    @Bean&#10;    public ProducerFactory&lt;String, Object&gt; producerFactory() {&#10;        Map&lt;String, Object&gt; configProps = new HashMap&lt;&gt;();&#10;        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);&#10;        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);&#10;        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);&#10;        return new DefaultKafkaProducerFactory&lt;&gt;(configProps);&#10;    }&#10;&#10;    @Bean&#10;    public KafkaTemplate&lt;String, Object&gt; kafkaTemplate() {&#10;        return new KafkaTemplate&lt;&gt;(producerFactory());&#10;    }&#10;&#10;    @Bean&#10;    public ConsumerFactory&lt;String, Object&gt; consumerFactory() {&#10;        Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();&#10;        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapServers);&#10;        props.put(ConsumerConfig.GROUP_ID_CONFIG, &quot;courier-service&quot;);&#10;        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);&#10;        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);&#10;        props.put(JsonDeserializer.TRUSTED_PACKAGES, &quot;*&quot;);&#10;        return new DefaultKafkaConsumerFactory&lt;&gt;(props);&#10;    }&#10;&#10;    @Bean&#10;    public ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; kafkaListenerContainerFactory() {&#10;        ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; factory = new ConcurrentKafkaListenerContainerFactory&lt;&gt;();&#10;        factory.setConsumerFactory(consumerFactory());&#10;        return factory;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/config/RedisConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/config/RedisConfig.java" />
              <option name="updatedContent" value="package com.api.demo.config;&#10;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.data.redis.connection.RedisConnectionFactory;&#10;import org.springframework.data.redis.core.RedisTemplate;&#10;import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;&#10;import org.springframework.data.redis.serializer.StringRedisSerializer;&#10;&#10;@Configuration&#10;public class RedisConfig {&#10;&#10;    @Bean&#10;    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory connectionFactory) {&#10;        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();&#10;        template.setConnectionFactory(connectionFactory);&#10;        &#10;        // String serializer for keys&#10;        template.setKeySerializer(new StringRedisSerializer());&#10;        template.setHashKeySerializer(new StringRedisSerializer());&#10;        &#10;        // JSON serializer for values&#10;        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());&#10;        template.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());&#10;        &#10;        return template;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/controller/CourierController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/controller/CourierController.java" />
              <option name="originalContent" value="package com.api.demo.controller;&#10;&#10;import com.api.demo.dto.CourierDTO;&#10;import com.api.demo.service.CourierService;&#10;import com.api.demo.service.CourierQueueService;&#10;import com.api.demo.service.CourierEventService;&#10;import com.api.demo.service.OrderAssignmentService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;import jakarta.validation.Valid;&#10;import java.util.List;&#10;import java.util.Map;&#10;import java.util.Optional;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/couriers&quot;)&#10;@CrossOrigin(origins = &quot;*&quot;)&#10;public class CourierController {&#10;&#10;    @Autowired&#10;    private CourierService courierService;&#10;&#10;    @Autowired&#10;    private CourierQueueService courierQueueService;&#10;&#10;    @Autowired&#10;    private CourierEventService courierEventService;&#10;&#10;    @Autowired&#10;    private OrderAssignmentService orderAssignmentService;&#10;&#10;    // Existing endpoints...&#10;    @GetMapping&#10;    public ResponseEntity&lt;List&lt;CourierDTO&gt;&gt; getAllCouriers() {&#10;        List&lt;CourierDTO&gt; couriers = courierService.getAllCouriers();&#10;        return ResponseEntity.ok(couriers);&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;CourierDTO&gt; getCourierById(@PathVariable Long id) {&#10;        Optional&lt;CourierDTO&gt; courier = courierService.getCourierById(id);&#10;        return courier.map(ResponseEntity::ok)&#10;                     .orElse(ResponseEntity.notFound().build());&#10;    }&#10;&#10;    @PostMapping&#10;    public ResponseEntity&lt;CourierDTO&gt; createCourier(@Valid @RequestBody CourierDTO courierDTO) {&#10;        CourierDTO createdCourier = courierService.createCourier(courierDTO);&#10;        return ResponseEntity.status(HttpStatus.CREATED).body(createdCourier);&#10;    }&#10;&#10;    @PutMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;CourierDTO&gt; updateCourier(@PathVariable Long id,&#10;                                                   @Valid @RequestBody CourierDTO courierDTO) {&#10;        Optional&lt;CourierDTO&gt; updatedCourier = courierService.updateCourier(id, courierDTO);&#10;        return updatedCourier.map(ResponseEntity::ok)&#10;                            .orElse(ResponseEntity.notFound().build());&#10;    }&#10;&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;Void&gt; deleteCourier(@PathVariable Long id) {&#10;        boolean deleted = courierService.deleteCourier(id);&#10;        return deleted ? ResponseEntity.noContent().build()&#10;                      : ResponseEntity.notFound().build();&#10;    }&#10;&#10;    // ===== YENİ VARDİYA VE SIRA YÖNETİMİ ENDPOİNTLERİ =====&#10;&#10;    /**&#10;     * Kurye vardiya başlatır&#10;     */&#10;    @PostMapping(&quot;/{id}/start-shift&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; startShift(@PathVariable Long id) {&#10;        try {&#10;            courierEventService.startCourierShift(id);&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Shift started successfully&quot;,&#10;                &quot;courierId&quot;, id,&#10;                &quot;queuePosition&quot;, courierQueueService.getCourierQueue().indexOf(id)&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to start shift: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya bitirir&#10;     */&#10;    @PostMapping(&quot;/{id}/end-shift&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; endShift(@PathVariable Long id) {&#10;        try {&#10;            courierEventService.endCourierShift(id);&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Shift ended successfully&quot;,&#10;                &quot;courierId&quot;, id&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to end shift: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye lokasyon günceller&#10;     */&#10;    @PostMapping(&quot;/{id}/update-location&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; updateLocation(&#10;            @PathVariable Long id,&#10;            @RequestBody Map&lt;String, Double&gt; location) {&#10;        try {&#10;            Double latitude = location.get(&quot;latitude&quot;);&#10;            Double longitude = location.get(&quot;longitude&quot;);&#10;&#10;            if (latitude == null || longitude == null) {&#10;                return ResponseEntity.badRequest().body(Map.of(&#10;                    &quot;success&quot;, false,&#10;                    &quot;message&quot;, &quot;Latitude and longitude are required&quot;&#10;                ));&#10;            }&#10;&#10;            courierEventService.updateCourierLocation(id, latitude, longitude);&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Location updated successfully&quot;,&#10;                &quot;courierId&quot;, id,&#10;                &quot;latitude&quot;, latitude,&#10;                &quot;longitude&quot;, longitude&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to update location: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye durumu günceller (AVAILABLE, BUSY, ON_BREAK)&#10;     */&#10;    @PostMapping(&quot;/{id}/update-status&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; updateStatus(&#10;            @PathVariable Long id,&#10;            @RequestBody Map&lt;String, String&gt; statusUpdate) {&#10;        try {&#10;            String newStatus = statusUpdate.get(&quot;status&quot;);&#10;            if (newStatus == null) {&#10;                return ResponseEntity.badRequest().body(Map.of(&#10;                    &quot;success&quot;, false,&#10;                    &quot;message&quot;, &quot;Status is required&quot;&#10;                ));&#10;            }&#10;&#10;            courierQueueService.updateCourierStatus(id, newStatus);&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Status updated successfully&quot;,&#10;                &quot;courierId&quot;, id,&#10;                &quot;status&quot;, newStatus&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to update status: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Aktif kurye sırasını getirir&#10;     */&#10;    @GetMapping(&quot;/queue&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getCourierQueue() {&#10;        try {&#10;            List&lt;Object&gt; queue = courierQueueService.getCourierQueue();&#10;            CourierQueueService.QueueStatistics stats = courierQueueService.getQueueStatistics();&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;queue&quot;, queue,&#10;                &quot;statistics&quot;, Map.of(&#10;                    &quot;totalCouriers&quot;, stats.getTotalCouriers(),&#10;                    &quot;availableCouriers&quot;, stats.getAvailableCouriers(),&#10;                    &quot;currentIndex&quot;, stats.getCurrentIndex()&#10;                )&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to get queue: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Sıradaki sıra numarasını getirir&#10;     */&#10;    @GetMapping(&quot;/{id}/queue-position&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getQueuePosition(@PathVariable Long id) {&#10;        try {&#10;            List&lt;Object&gt; queue = courierQueueService.getCourierQueue();&#10;            int position = queue.indexOf(id);&#10;            boolean inQueue = courierQueueService.isCourierInQueue(id);&#10;            boolean available = courierQueueService.isCourierAvailable(id);&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;courierId&quot;, id,&#10;                &quot;inQueue&quot;, inQueue,&#10;                &quot;position&quot;, position &gt;= 0 ? position : -1,&#10;                &quot;isAvailable&quot;, available,&#10;                &quot;queueSize&quot;, queue.size()&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to get queue position: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Sıradaki sırada bekleyen kuryeyi getirir (test amaçlı)&#10;     */&#10;    @GetMapping(&quot;/next-available&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getNextAvailableCourier() {&#10;        try {&#10;            Long nextCourierId = courierQueueService.getNextAvailableCourier();&#10;&#10;            if (nextCourierId != null) {&#10;                return ResponseEntity.ok(Map.of(&#10;                    &quot;success&quot;, true,&#10;                    &quot;nextCourierId&quot;, nextCourierId,&#10;                    &quot;message&quot;, &quot;Next available courier found&quot;&#10;                ));&#10;            } else {&#10;                return ResponseEntity.ok(Map.of(&#10;                    &quot;success&quot;, false,&#10;                    &quot;message&quot;, &quot;No available courier in queue&quot;&#10;                ));&#10;            }&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to get next courier: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Toplu optimizasyon tetikler (admin için)&#10;     */&#10;    @PostMapping(&quot;/optimize-assignments&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; optimizeAssignments() {&#10;        try {&#10;            orderAssignmentService.optimizeBulkAssignments();&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Bulk optimization triggered successfully&quot;&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to trigger optimization: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    // Existing methods continue...&#10;    @GetMapping(&quot;/available&quot;)&#10;    public ResponseEntity&lt;List&lt;CourierDTO&gt;&gt; getAvailableCouriers() {&#10;        List&lt;CourierDTO&gt; availableCouriers = courierService.getAvailableCouriers();&#10;        return ResponseEntity.ok(availableCouriers);&#10;    }&#10;&#10;    @GetMapping(&quot;/search&quot;)&#10;    public ResponseEntity&lt;List&lt;CourierDTO&gt;&gt; searchCouriers(@RequestParam String name) {&#10;        List&lt;CourierDTO&gt; couriers = courierService.searchCouriersByName(name);&#10;        return ResponseEntity.ok(couriers);&#10;    }&#10;&#10;    @GetMapping(&quot;/count/available&quot;)&#10;    public ResponseEntity&lt;Long&gt; countAvailableCouriers() {&#10;        Long count = courierService.countAvailableCouriers();&#10;        return ResponseEntity.ok(count);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.api.demo.controller;&#10;&#10;import com.api.demo.dto.CourierDTO;&#10;import com.api.demo.service.CourierService;&#10;import com.api.demo.service.CourierQueueService;&#10;import com.api.demo.service.CourierEventService;&#10;import com.api.demo.service.OrderAssignmentService;&#10;import org.springframework.http.HttpStatus;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;import jakarta.validation.Valid;&#10;import java.util.List;&#10;import java.util.Map;&#10;import java.util.Optional;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/couriers&quot;)&#10;@CrossOrigin(origins = &quot;*&quot;)&#10;public class CourierController {&#10;    &#10;    private final CourierService courierService;&#10;    private final CourierQueueService courierQueueService;&#10;    private final CourierEventService courierEventService;&#10;    private final OrderAssignmentService orderAssignmentService;&#10;    &#10;    public CourierController(&#10;            CourierService courierService,&#10;            CourierQueueService courierQueueService,&#10;            CourierEventService courierEventService,&#10;            OrderAssignmentService orderAssignmentService) {&#10;        this.courierService = courierService;&#10;        this.courierQueueService = courierQueueService;&#10;        this.courierEventService = courierEventService;&#10;        this.orderAssignmentService = orderAssignmentService;&#10;    }&#10;    &#10;    // Existing endpoints...&#10;    @GetMapping&#10;    public ResponseEntity&lt;List&lt;CourierDTO&gt;&gt; getAllCouriers() {&#10;        List&lt;CourierDTO&gt; couriers = courierService.getAllCouriers();&#10;        return ResponseEntity.ok(couriers);&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;CourierDTO&gt; getCourierById(@PathVariable Long id) {&#10;        Optional&lt;CourierDTO&gt; courier = courierService.getCourierById(id);&#10;        return courier.map(ResponseEntity::ok)&#10;                     .orElse(ResponseEntity.notFound().build());&#10;    }&#10;&#10;    @PostMapping&#10;    public ResponseEntity&lt;CourierDTO&gt; createCourier(@Valid @RequestBody CourierDTO courierDTO) {&#10;        CourierDTO createdCourier = courierService.createCourier(courierDTO);&#10;        return ResponseEntity.status(HttpStatus.CREATED).body(createdCourier);&#10;    }&#10;&#10;    @PutMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;CourierDTO&gt; updateCourier(@PathVariable Long id,&#10;                                                   @Valid @RequestBody CourierDTO courierDTO) {&#10;        Optional&lt;CourierDTO&gt; updatedCourier = courierService.updateCourier(id, courierDTO);&#10;        return updatedCourier.map(ResponseEntity::ok)&#10;                            .orElse(ResponseEntity.notFound().build());&#10;    }&#10;&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;Void&gt; deleteCourier(@PathVariable Long id) {&#10;        boolean deleted = courierService.deleteCourier(id);&#10;        return deleted ? ResponseEntity.noContent().build()&#10;                      : ResponseEntity.notFound().build();&#10;    }&#10;&#10;    // ===== YENİ VARDİYA VE SIRA YÖNETİMİ ENDPOİNTLERİ =====&#10;&#10;    /**&#10;     * Kurye vardiya başlatır&#10;     */&#10;    @PostMapping(&quot;/{id}/start-shift&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; startShift(@PathVariable Long id) {&#10;        try {&#10;            courierEventService.startCourierShift(id);&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Shift started successfully&quot;,&#10;                &quot;courierId&quot;, id,&#10;                &quot;queuePosition&quot;, courierQueueService.getCourierQueue().indexOf(id)&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to start shift: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya bitirir&#10;     */&#10;    @PostMapping(&quot;/{id}/end-shift&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; endShift(@PathVariable Long id) {&#10;        try {&#10;            courierEventService.endCourierShift(id);&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Shift ended successfully&quot;,&#10;                &quot;courierId&quot;, id&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to end shift: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye lokasyon günceller&#10;     */&#10;    @PostMapping(&quot;/{id}/update-location&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; updateLocation(&#10;            @PathVariable Long id,&#10;            @RequestBody Map&lt;String, Double&gt; location) {&#10;        try {&#10;            Double latitude = location.get(&quot;latitude&quot;);&#10;            Double longitude = location.get(&quot;longitude&quot;);&#10;&#10;            if (latitude == null || longitude == null) {&#10;                return ResponseEntity.badRequest().body(Map.of(&#10;                    &quot;success&quot;, false,&#10;                    &quot;message&quot;, &quot;Latitude and longitude are required&quot;&#10;                ));&#10;            }&#10;&#10;            courierEventService.updateCourierLocation(id, latitude, longitude);&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Location updated successfully&quot;,&#10;                &quot;courierId&quot;, id,&#10;                &quot;latitude&quot;, latitude,&#10;                &quot;longitude&quot;, longitude&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to update location: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye durumu günceller (AVAILABLE, BUSY, ON_BREAK)&#10;     */&#10;    @PostMapping(&quot;/{id}/update-status&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; updateStatus(&#10;            @PathVariable Long id,&#10;            @RequestBody Map&lt;String, String&gt; statusUpdate) {&#10;        try {&#10;            String newStatus = statusUpdate.get(&quot;status&quot;);&#10;            if (newStatus == null) {&#10;                return ResponseEntity.badRequest().body(Map.of(&#10;                    &quot;success&quot;, false,&#10;                    &quot;message&quot;, &quot;Status is required&quot;&#10;                ));&#10;            }&#10;&#10;            courierQueueService.updateCourierStatus(id, newStatus);&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Status updated successfully&quot;,&#10;                &quot;courierId&quot;, id,&#10;                &quot;status&quot;, newStatus&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to update status: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Aktif kurye sırasını getirir&#10;     */&#10;    @GetMapping(&quot;/queue&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getCourierQueue() {&#10;        try {&#10;            List&lt;Object&gt; queue = courierQueueService.getCourierQueue();&#10;            CourierQueueService.QueueStatistics stats = courierQueueService.getQueueStatistics();&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;queue&quot;, queue,&#10;                &quot;statistics&quot;, Map.of(&#10;                    &quot;totalCouriers&quot;, stats.getTotalCouriers(),&#10;                    &quot;availableCouriers&quot;, stats.getAvailableCouriers(),&#10;                    &quot;currentIndex&quot;, stats.getCurrentIndex()&#10;                )&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to get queue: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Sıradaki sıra numarasını getirir&#10;     */&#10;    @GetMapping(&quot;/{id}/queue-position&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getQueuePosition(@PathVariable Long id) {&#10;        try {&#10;            List&lt;Object&gt; queue = courierQueueService.getCourierQueue();&#10;            int position = queue.indexOf(id);&#10;            boolean inQueue = courierQueueService.isCourierInQueue(id);&#10;            boolean available = courierQueueService.isCourierAvailable(id);&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;courierId&quot;, id,&#10;                &quot;inQueue&quot;, inQueue,&#10;                &quot;position&quot;, position &gt;= 0 ? position : -1,&#10;                &quot;isAvailable&quot;, available,&#10;                &quot;queueSize&quot;, queue.size()&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to get queue position: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Sıradaki sırada bekleyen kuryeyi getirir (test amaçlı)&#10;     */&#10;    @GetMapping(&quot;/next-available&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getNextAvailableCourier() {&#10;        try {&#10;            Long nextCourierId = courierQueueService.getNextAvailableCourier();&#10;&#10;            if (nextCourierId != null) {&#10;                return ResponseEntity.ok(Map.of(&#10;                    &quot;success&quot;, true,&#10;                    &quot;nextCourierId&quot;, nextCourierId,&#10;                    &quot;message&quot;, &quot;Next available courier found&quot;&#10;                ));&#10;            } else {&#10;                return ResponseEntity.ok(Map.of(&#10;                    &quot;success&quot;, false,&#10;                    &quot;message&quot;, &quot;No available courier in queue&quot;&#10;                ));&#10;            }&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to get next courier: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Toplu optimizasyon tetikler (admin için)&#10;     */&#10;    @PostMapping(&quot;/optimize-assignments&quot;)&#10;    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; optimizeAssignments() {&#10;        try {&#10;            orderAssignmentService.optimizeBulkAssignments();&#10;&#10;            return ResponseEntity.ok(Map.of(&#10;                &quot;success&quot;, true,&#10;                &quot;message&quot;, &quot;Bulk optimization triggered successfully&quot;&#10;            ));&#10;        } catch (Exception e) {&#10;            return ResponseEntity.badRequest().body(Map.of(&#10;                &quot;success&quot;, false,&#10;                &quot;message&quot;, &quot;Failed to trigger optimization: &quot; + e.getMessage()&#10;            ));&#10;        }&#10;    }&#10;&#10;    // Existing methods continue...&#10;    @GetMapping(&quot;/available&quot;)&#10;    public ResponseEntity&lt;List&lt;CourierDTO&gt;&gt; getAvailableCouriers() {&#10;        List&lt;CourierDTO&gt; availableCouriers = courierService.getAvailableCouriers();&#10;        return ResponseEntity.ok(availableCouriers);&#10;    }&#10;&#10;    @GetMapping(&quot;/search&quot;)&#10;    public ResponseEntity&lt;List&lt;CourierDTO&gt;&gt; searchCouriers(@RequestParam String name) {&#10;        List&lt;CourierDTO&gt; couriers = courierService.searchCouriersByName(name);&#10;        return ResponseEntity.ok(couriers);&#10;    }&#10;&#10;    @GetMapping(&quot;/count/available&quot;)&#10;    public ResponseEntity&lt;Long&gt; countAvailableCouriers() {&#10;        Long count = courierService.countAvailableCouriers();&#10;        return ResponseEntity.ok(count);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/dto/CourierDTO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/dto/CourierDTO.java" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.api.demo.dto;&#10;&#10;import jakarta.validation.constraints.Email;&#10;import jakarta.validation.constraints.NotBlank;&#10;import jakarta.validation.constraints.Size;&#10;&#10;public class CourierDTO {&#10;    &#10;    private Long id;&#10;    &#10;    @NotBlank(message = &quot;Name is required&quot;)&#10;    @Size(min = 2, max = 100, message = &quot;Name must be between 2 and 100 characters&quot;)&#10;    private String name;&#10;    &#10;    @NotBlank(message = &quot;Email is required&quot;)&#10;    @Email(message = &quot;Email should be valid&quot;)&#10;    private String email;&#10;    &#10;    @Size(max = 20, message = &quot;Phone number cannot exceed 20 characters&quot;)&#10;    private String phone;&#10;    &#10;    private Boolean isAvailable;&#10;    &#10;    // Constructors&#10;    public CourierDTO() {}&#10;    &#10;    public CourierDTO(String name, String email, String phone) {&#10;        this.name = name;&#10;        this.email = email;&#10;        this.phone = phone;&#10;        this.isAvailable = true;&#10;    }&#10;    &#10;    // Getters and Setters&#10;    public Long getId() { return id; }&#10;    public void setId(Long id) { this.id = id; }&#10;    &#10;    public String getName() { return name; }&#10;    public void setName(String name) { this.name = name; }&#10;    &#10;    public String getEmail() { return email; }&#10;    public void setEmail(String email) { this.email = email; }&#10;    &#10;    public String getPhone() { return phone; }&#10;    public void setPhone(String phone) { this.phone = phone; }&#10;    &#10;    public Boolean getIsAvailable() { return isAvailable; }&#10;    public void setIsAvailable(Boolean isAvailable) { this.isAvailable = isAvailable; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Business.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Business.java" />
              <option name="updatedContent" value="package com.api.demo.entity;&#10;&#10;import jakarta.persistence.*;&#10;import java.math.BigDecimal;&#10;import java.time.LocalDateTime;&#10;import java.util.Set;&#10;&#10;@Entity&#10;@Table(name = &quot;businesses&quot;)&#10;public class Business {&#10;    &#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;    &#10;    @Column(name = &quot;business_code&quot;, unique = true, nullable = false)&#10;    private String businessCode;&#10;    &#10;    @Column(name = &quot;name&quot;, nullable = false, length = 200)&#10;    private String name;&#10;    &#10;    @Column(name = &quot;contact_person&quot;, length = 100)&#10;    private String contactPerson;&#10;    &#10;    @Column(name = &quot;phone&quot;, nullable = false, length = 20)&#10;    private String phone;&#10;    &#10;    @Column(name = &quot;email&quot;, length = 100)&#10;    private String email;&#10;    &#10;    @Column(name = &quot;address&quot;, nullable = false, length = 500)&#10;    private String address;&#10;    &#10;    @Column(name = &quot;address_description&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String addressDescription;&#10;    &#10;    @Column(name = &quot;latitude&quot;)&#10;    private Double latitude;&#10;    &#10;    @Column(name = &quot;longitude&quot;)&#10;    private Double longitude;&#10;    &#10;    @Column(name = &quot;location_name&quot;, length = 200)&#10;    private String locationName;&#10;    &#10;    @Column(name = &quot;business_type&quot;, length = 100)&#10;    private String businessType;&#10;    &#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;payment_terms&quot;)&#10;    private PaymentTerms paymentTerms = PaymentTerms.POSTPAID;&#10;    &#10;    @Column(name = &quot;credit_limit&quot;, precision = 10, scale = 2)&#10;    private BigDecimal creditLimit = BigDecimal.ZERO;&#10;    &#10;    @Column(name = &quot;is_active&quot;)&#10;    private Boolean isActive = true;&#10;    &#10;    @Column(name = &quot;notes&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String notes;&#10;    &#10;    @Column(name = &quot;created_at&quot;)&#10;    private LocalDateTime createdAt;&#10;    &#10;    @Column(name = &quot;updated_at&quot;)&#10;    private LocalDateTime updatedAt;&#10;    &#10;    // Relationships&#10;    @OneToMany(mappedBy = &quot;business&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)&#10;    private Set&lt;Order&gt; orders;&#10;    &#10;    @PrePersist&#10;    protected void onCreate() {&#10;        createdAt = LocalDateTime.now();&#10;        updatedAt = LocalDateTime.now();&#10;        if (businessCode == null) {&#10;            businessCode = &quot;BUS&quot; + String.format(&quot;%06d&quot;, System.currentTimeMillis() % 1000000);&#10;        }&#10;    }&#10;    &#10;    @PreUpdate&#10;    protected void onUpdate() {&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;    &#10;    // Enums&#10;    public enum PaymentTerms {&#10;        PREPAID,        // Ön ödeme&#10;        POSTPAID,       // Vadeli ödeme&#10;        CASH_ON_DELIVERY // Kapıda tahsilat&#10;    }&#10;    &#10;    // Constructors&#10;    public Business() {}&#10;    &#10;    public Business(String name, String phone, String address) {&#10;        this.name = name;&#10;        this.phone = phone;&#10;        this.address = address;&#10;    }&#10;    &#10;    // Getters and Setters&#10;    public Long getId() { return id; }&#10;    public void setId(Long id) { this.id = id; }&#10;    &#10;    public String getBusinessCode() { return businessCode; }&#10;    public void setBusinessCode(String businessCode) { this.businessCode = businessCode; }&#10;    &#10;    public String getName() { return name; }&#10;    public void setName(String name) { this.name = name; }&#10;    &#10;    public String getContactPerson() { return contactPerson; }&#10;    public void setContactPerson(String contactPerson) { this.contactPerson = contactPerson; }&#10;    &#10;    public String getPhone() { return phone; }&#10;    public void setPhone(String phone) { this.phone = phone; }&#10;    &#10;    public String getEmail() { return email; }&#10;    public void setEmail(String email) { this.email = email; }&#10;    &#10;    public String getAddress() { return address; }&#10;    public void setAddress(String address) { this.address = address; }&#10;    &#10;    public String getAddressDescription() { return addressDescription; }&#10;    public void setAddressDescription(String addressDescription) { this.addressDescription = addressDescription; }&#10;    &#10;    public Double getLatitude() { return latitude; }&#10;    public void setLatitude(Double latitude) { this.latitude = latitude; }&#10;    &#10;    public Double getLongitude() { return longitude; }&#10;    public void setLongitude(Double longitude) { this.longitude = longitude; }&#10;    &#10;    public String getLocationName() { return locationName; }&#10;    public void setLocationName(String locationName) { this.locationName = locationName; }&#10;    &#10;    public String getBusinessType() { return businessType; }&#10;    public void setBusinessType(String businessType) { this.businessType = businessType; }&#10;    &#10;    public PaymentTerms getPaymentTerms() { return paymentTerms; }&#10;    public void setPaymentTerms(PaymentTerms paymentTerms) { this.paymentTerms = paymentTerms; }&#10;    &#10;    public BigDecimal getCreditLimit() { return creditLimit; }&#10;    public void setCreditLimit(BigDecimal creditLimit) { this.creditLimit = creditLimit; }&#10;    &#10;    public Boolean getIsActive() { return isActive; }&#10;    public void setIsActive(Boolean isActive) { this.isActive = isActive; }&#10;    &#10;    public String getNotes() { return notes; }&#10;    public void setNotes(String notes) { this.notes = notes; }&#10;    &#10;    public Set&lt;Order&gt; getOrders() { return orders; }&#10;    public void setOrders(Set&lt;Order&gt; orders) { this.orders = orders; }&#10;    &#10;    public LocalDateTime getCreatedAt() { return createdAt; }&#10;    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }&#10;    &#10;    public LocalDateTime getUpdatedAt() { return updatedAt; }&#10;    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Coordinator.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Coordinator.java" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.api.demo.entity;&#10;&#10;import jakarta.persistence.*;&#10;import java.time.LocalDateTime;&#10;import java.time.LocalTime;&#10;import java.util.Set;&#10;&#10;@Entity&#10;@Table(name = &quot;coordinators&quot;)&#10;public class Coordinator {&#10;    &#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;    &#10;    @OneToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;system_user_id&quot;, unique = true)&#10;    private SystemUser systemUser;&#10;    &#10;    @Column(name = &quot;name&quot;, nullable = false)&#10;    private String name;&#10;    &#10;    @Column(name = &quot;email&quot;, unique = true, nullable = false)&#10;    private String email;&#10;    &#10;    @Column(name = &quot;phone&quot;, nullable = false)&#10;    private String phone;&#10;    &#10;    @Column(name = &quot;employee_id&quot;, unique = true)&#10;    private String employeeId;&#10;    &#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;work_type&quot;, nullable = false)&#10;    private WorkType workType = WorkType.SHIFT;&#10;    &#10;    @Column(name = &quot;shift_start&quot;)&#10;    private LocalTime shiftStart;&#10;    &#10;    @Column(name = &quot;shift_end&quot;)&#10;    private LocalTime shiftEnd;&#10;    &#10;    @Column(name = &quot;is_active&quot;)&#10;    private Boolean isActive = true;&#10;    &#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;status&quot;)&#10;    private CoordinatorStatus status = CoordinatorStatus.OFFLINE;&#10;    &#10;    @Column(name = &quot;current_latitude&quot;)&#10;    private Double currentLatitude;&#10;    &#10;    @Column(name = &quot;current_longitude&quot;)&#10;    private Double currentLongitude;&#10;    &#10;    @Column(name = &quot;coverage_area&quot;, length = 500)&#10;    private String coverageArea;&#10;    &#10;    @Column(name = &quot;max_courier_count&quot;)&#10;    private Integer maxCourierCount = 10;&#10;    &#10;    // İlişkiler&#10;    @OneToMany(mappedBy = &quot;coordinator&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)&#10;    private Set&lt;Courier&gt; managedCouriers;&#10;    &#10;    @OneToMany(mappedBy = &quot;coordinator&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)&#10;    private Set&lt;Order&gt; supervisedOrders;&#10;    &#10;    @Column(name = &quot;created_at&quot;)&#10;    private LocalDateTime createdAt;&#10;    &#10;    @Column(name = &quot;updated_at&quot;)&#10;    private LocalDateTime updatedAt;&#10;    &#10;    @PrePersist&#10;    protected void onCreate() {&#10;        createdAt = LocalDateTime.now();&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;    &#10;    @PreUpdate&#10;    protected void onUpdate() {&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;    &#10;    // Enums&#10;    public enum CoordinatorStatus {&#10;        ONLINE, OFFLINE, BUSY, ON_BREAK, IN_FIELD&#10;    }&#10;    &#10;    public enum WorkType {&#10;        JOKER, SHIFT&#10;    }&#10;    &#10;    // Constructors&#10;    public Coordinator() {}&#10;    &#10;    public Coordinator(String name, String email, String phone) {&#10;        this.name = name;&#10;        this.email = email;&#10;        this.phone = phone;&#10;    }&#10;    &#10;    // Getters and Setters&#10;    public Long getId() { return id; }&#10;    public void setId(Long id) { this.id = id; }&#10;    &#10;    public SystemUser getSystemUser() { return systemUser; }&#10;    public void setSystemUser(SystemUser systemUser) { this.systemUser = systemUser; }&#10;    &#10;    public String getName() { return name; }&#10;    public void setName(String name) { this.name = name; }&#10;    &#10;    public String getEmail() { return email; }&#10;    public void setEmail(String email) { this.email = email; }&#10;    &#10;    public String getPhone() { return phone; }&#10;    public void setPhone(String phone) { this.phone = phone; }&#10;    &#10;    public String getEmployeeId() { return employeeId; }&#10;    public void setEmployeeId(String employeeId) { this.employeeId = employeeId; }&#10;    &#10;    public WorkType getWorkType() { return workType; }&#10;    public void setWorkType(WorkType workType) { this.workType = workType; }&#10;    &#10;    public LocalTime getShiftStart() { return shiftStart; }&#10;    public void setShiftStart(LocalTime shiftStart) { this.shiftStart = shiftStart; }&#10;    &#10;    public LocalTime getShiftEnd() { return shiftEnd; }&#10;    public void setShiftEnd(LocalTime shiftEnd) { this.shiftEnd = shiftEnd; }&#10;    &#10;    public Boolean getIsActive() { return isActive; }&#10;    public void setIsActive(Boolean isActive) { this.isActive = isActive; }&#10;    &#10;    public CoordinatorStatus getStatus() { return status; }&#10;    public void setStatus(CoordinatorStatus status) { this.status = status; }&#10;    &#10;    public Double getCurrentLatitude() { return currentLatitude; }&#10;    public void setCurrentLatitude(Double currentLatitude) { this.currentLatitude = currentLatitude; }&#10;    &#10;    public Double getCurrentLongitude() { return currentLongitude; }&#10;    public void setCurrentLongitude(Double currentLongitude) { this.currentLongitude = currentLongitude; }&#10;    &#10;    public String getCoverageArea() { return coverageArea; }&#10;    public void setCoverageArea(String coverageArea) { this.coverageArea = coverageArea; }&#10;    &#10;    public Integer getMaxCourierCount() { return maxCourierCount; }&#10;    public void setMaxCourierCount(Integer maxCourierCount) { this.maxCourierCount = maxCourierCount; }&#10;    &#10;    public Set&lt;Courier&gt; getManagedCouriers() { return managedCouriers; }&#10;    public void setManagedCouriers(Set&lt;Courier&gt; managedCouriers) { this.managedCouriers = managedCouriers; }&#10;    &#10;    public Set&lt;Order&gt; getSupervisedOrders() { return supervisedOrders; }&#10;    public void setSupervisedOrders(Set&lt;Order&gt; supervisedOrders) { this.supervisedOrders = supervisedOrders; }&#10;    &#10;    public LocalDateTime getCreatedAt() { return createdAt; }&#10;    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }&#10;    &#10;    public LocalDateTime getUpdatedAt() { return updatedAt; }&#10;    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Courier.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Courier.java" />
              <option name="originalContent" value="&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.api.demo.entity;&#10;&#10;import jakarta.persistence.*;&#10;import java.time.LocalDateTime;&#10;import java.time.LocalTime;&#10;import java.util.Set;&#10;&#10;@Entity&#10;@Table(name = &quot;couriers&quot;)&#10;public class Courier {&#10;&#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;&#10;    @OneToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;system_user_id&quot;, unique = true)&#10;    private SystemUser systemUser;&#10;&#10;    @Column(name = &quot;name&quot;, nullable = false)&#10;    private String name;&#10;&#10;    @Column(name = &quot;email&quot;, unique = true, nullable = false)&#10;    private String email;&#10;&#10;    @Column(name = &quot;phone&quot;, nullable = false)&#10;    private String phone;&#10;&#10;    @Column(name = &quot;license_number&quot;)&#10;    private String licenseNumber;&#10;&#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;vehicle_type&quot;)&#10;    private VehicleType vehicleType;&#10;&#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;work_type&quot;, nullable = false)&#10;    private WorkType workType = WorkType.SHIFT;&#10;&#10;    @Column(name = &quot;shift_start&quot;)&#10;    private LocalTime shiftStart;&#10;&#10;    @Column(name = &quot;shift_end&quot;)&#10;    private LocalTime shiftEnd;&#10;&#10;    @Column(name = &quot;is_available&quot;)&#10;    private Boolean isAvailable = true;&#10;&#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;status&quot;)&#10;    private CourierStatus status = CourierStatus.OFFLINE;&#10;&#10;    @Column(name = &quot;current_latitude&quot;)&#10;    private Double currentLatitude;&#10;&#10;    @Column(name = &quot;current_longitude&quot;)&#10;    private Double currentLongitude;&#10;&#10;    @Column(name = &quot;current_location_name&quot;)&#10;    private String currentLocationName;&#10;&#10;    @Column(name = &quot;total_deliveries&quot;)&#10;    private Integer totalDeliveries = 0;&#10;&#10;    // Koordinatör ilişkisi&#10;    @ManyToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;coordinator_id&quot;)&#10;    private Coordinator coordinator;&#10;&#10;    // Relationships&#10;    @OneToOne(cascade = CascadeType.ALL, fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;vehicle_id&quot;)&#10;    private Vehicle vehicle;&#10;&#10;    @OneToMany(mappedBy = &quot;courier&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)&#10;    private Set&lt;Order&gt; orders;&#10;&#10;    @Column(name = &quot;created_at&quot;)&#10;    private LocalDateTime createdAt;&#10;&#10;    @Column(name = &quot;updated_at&quot;)&#10;    private LocalDateTime updatedAt;&#10;&#10;    @PrePersist&#10;    protected void onCreate() {&#10;        createdAt = LocalDateTime.now();&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;&#10;    @PreUpdate&#10;    protected void onUpdate() {&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;&#10;    // Enums&#10;    public enum CourierStatus {&#10;        ONLINE, OFFLINE, BUSY, ON_BREAK, IN_DELIVERY&#10;    }&#10;&#10;    public enum WorkType {&#10;        JOKER,    // Esnek çalışma&#10;        SHIFT     // Vardiyalı çalışma&#10;    }&#10;&#10;    public enum VehicleType {&#10;        BICYCLE, MOTORCYCLE, CAR, VAN, TRUCK, WALKING&#10;    }&#10;&#10;    // Constructors&#10;    public Courier() {}&#10;&#10;    public Courier(String name, String email, String phone) {&#10;        this.name = name;&#10;        this.email = email;&#10;        this.phone = phone;&#10;    }&#10;&#10;    // Getters and Setters&#10;    public Long getId() { return id; }&#10;    public void setId(Long id) { this.id = id; }&#10;&#10;    public SystemUser getSystemUser() { return systemUser; }&#10;    public void setSystemUser(SystemUser systemUser) { this.systemUser = systemUser; }&#10;&#10;    public String getName() { return name; }&#10;    public void setName(String name) { this.name = name; }&#10;&#10;    public String getEmail() { return email; }&#10;    public void setEmail(String email) { this.email = email; }&#10;&#10;    public String getPhone() { return phone; }&#10;    public void setPhone(String phone) { this.phone = phone; }&#10;&#10;    public String getLicenseNumber() { return licenseNumber; }&#10;    public void setLicenseNumber(String licenseNumber) { this.licenseNumber = licenseNumber; }&#10;&#10;    public VehicleType getVehicleType() { return vehicleType; }&#10;    public void setVehicleType(VehicleType vehicleType) { this.vehicleType = vehicleType; }&#10;&#10;    public WorkType getWorkType() { return workType; }&#10;    public void setWorkType(WorkType workType) { this.workType = workType; }&#10;&#10;    public LocalTime getShiftStart() { return shiftStart; }&#10;    public void setShiftStart(LocalTime shiftStart) { this.shiftStart = shiftStart; }&#10;&#10;    public LocalTime getShiftEnd() { return shiftEnd; }&#10;    public void setShiftEnd(LocalTime shiftEnd) { this.shiftEnd = shiftEnd; }&#10;&#10;    public Boolean getIsAvailable() { return isAvailable; }&#10;    public void setIsAvailable(Boolean isAvailable) { this.isAvailable = isAvailable; }&#10;&#10;    public CourierStatus getStatus() { return status; }&#10;    public void setStatus(CourierStatus status) { this.status = status; }&#10;&#10;    public Double getCurrentLatitude() { return currentLatitude; }&#10;    public void setCurrentLatitude(Double currentLatitude) { this.currentLatitude = currentLatitude; }&#10;&#10;    public Double getCurrentLongitude() { return currentLongitude; }&#10;    public void setCurrentLongitude(Double currentLongitude) { this.currentLongitude = currentLongitude; }&#10;&#10;    public String getCurrentLocationName() { return currentLocationName; }&#10;    public void setCurrentLocationName(String currentLocationName) { this.currentLocationName = currentLocationName; }&#10;&#10;    public Integer getTotalDeliveries() { return totalDeliveries; }&#10;    public void setTotalDeliveries(Integer totalDeliveries) { this.totalDeliveries = totalDeliveries; }&#10;&#10;    public Coordinator getCoordinator() { return coordinator; }&#10;    public void setCoordinator(Coordinator coordinator) { this.coordinator = coordinator; }&#10;&#10;    public Vehicle getVehicle() { return vehicle; }&#10;    public void setVehicle(Vehicle vehicle) { this.vehicle = vehicle; }&#10;&#10;    public Set&lt;Order&gt; getOrders() { return orders; }&#10;    public void setOrders(Set&lt;Order&gt; orders) { this.orders = orders; }&#10;&#10;    public LocalDateTime getCreatedAt() { return createdAt; }&#10;    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }&#10;&#10;    public LocalDateTime getUpdatedAt() { return updatedAt; }&#10;    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Order.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Order.java" />
              <option name="originalContent" value="&#10;&#10;" />
              <option name="updatedContent" value="package com.api.demo.entity;&#10;&#10;import jakarta.persistence.*;&#10;import java.math.BigDecimal;&#10;import java.time.LocalDateTime;&#10;&#10;@Entity&#10;@Table(name = &quot;orders&quot;)&#10;public class Order {&#10;    &#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;    &#10;    @Column(name = &quot;order_number&quot;, unique = true, nullable = false)&#10;    private String orderNumber;&#10;    &#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;status&quot;)&#10;    private OrderStatus status = OrderStatus.PENDING;&#10;    &#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;priority&quot;)&#10;    private OrderPriority priority = OrderPriority.NORMAL;&#10;    &#10;    // İşletme bilgileri (sipariş veren)&#10;    @ManyToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;business_id&quot;, nullable = false)&#10;    private Business business;&#10;    &#10;    @Column(name = &quot;business_contact_person&quot;)&#10;    private String businessContactPerson;&#10;    &#10;    @Column(name = &quot;business_phone&quot;)&#10;    private String businessPhone;&#10;    &#10;    // Kurye ve koordinatör bilgileri&#10;    @ManyToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;courier_id&quot;)&#10;    private Courier courier;&#10;    &#10;    @ManyToOne(fetch = FetchType.LAZY)&#10;    @JoinColumn(name = &quot;coordinator_id&quot;)&#10;    private Coordinator coordinator;&#10;    &#10;    // Son müşteri bilgileri (teslimat alacak kişi)&#10;    @Column(name = &quot;end_customer_name&quot;, nullable = false)&#10;    private String endCustomerName;&#10;    &#10;    @Column(name = &quot;end_customer_phone&quot;)&#10;    private String endCustomerPhone;&#10;    &#10;    // Alım lokasyonu (işletmeden)&#10;    @Column(name = &quot;pickup_address&quot;, nullable = false, columnDefinition = &quot;TEXT&quot;)&#10;    private String pickupAddress;&#10;    &#10;    @Column(name = &quot;pickup_address_description&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String pickupAddressDescription;&#10;    &#10;    @Column(name = &quot;pickup_latitude&quot;)&#10;    private Double pickupLatitude;&#10;    &#10;    @Column(name = &quot;pickup_longitude&quot;)&#10;    private Double pickupLongitude;&#10;    &#10;    @Column(name = &quot;pickup_location_name&quot;)&#10;    private String pickupLocationName;&#10;    &#10;    @Column(name = &quot;pickup_contact_person&quot;)&#10;    private String pickupContactPerson;&#10;    &#10;    // Teslimat lokasyonu (son müşteriye)&#10;    @Column(name = &quot;delivery_address&quot;, nullable = false, columnDefinition = &quot;TEXT&quot;)&#10;    private String deliveryAddress;&#10;    &#10;    @Column(name = &quot;delivery_address_description&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String deliveryAddressDescription;&#10;    &#10;    @Column(name = &quot;delivery_latitude&quot;)&#10;    private Double deliveryLatitude;&#10;    &#10;    @Column(name = &quot;delivery_longitude&quot;)&#10;    private Double deliveryLongitude;&#10;    &#10;    @Column(name = &quot;delivery_location_name&quot;)&#10;    private String deliveryLocationName;&#10;    &#10;    // Paket bilgileri&#10;    @Column(name = &quot;package_description&quot;, nullable = false, length = 500)&#10;    private String packageDescription;&#10;    &#10;    @Column(name = &quot;package_weight&quot;)&#10;    private Double packageWeight;&#10;    &#10;    @Column(name = &quot;package_count&quot;)&#10;    private Integer packageCount = 1;&#10;    &#10;    @Column(name = &quot;package_value&quot;, precision = 10, scale = 2)&#10;    private BigDecimal packageValue;&#10;    &#10;    // Ödeme bilgileri&#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;payment_type&quot;)&#10;    private PaymentType paymentType = PaymentType.BUSINESS_ACCOUNT;&#10;    &#10;    @Column(name = &quot;delivery_fee&quot;, precision = 10, scale = 2, nullable = false)&#10;    private BigDecimal deliveryFee;&#10;    &#10;    @Column(name = &quot;collection_amount&quot;, precision = 10, scale = 2)&#10;    private BigDecimal collectionAmount = BigDecimal.ZERO;&#10;    &#10;    // Notlar ve dökümanlar&#10;    @Column(name = &quot;courier_notes&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String courierNotes;&#10;    &#10;    @Column(name = &quot;business_notes&quot;, columnDefinition = &quot;TEXT&quot;)&#10;    private String businessNotes;&#10;    &#10;    @Column(name = &quot;receipt_image_url&quot;, length = 500)&#10;    private String receiptImageUrl;&#10;    &#10;    @Column(name = &quot;delivery_proof_url&quot;, length = 500)&#10;    private String deliveryProofUrl;&#10;    &#10;    // Zaman bilgileri&#10;    @Column(name = &quot;order_date&quot;)&#10;    private LocalDateTime orderDate;&#10;    &#10;    @Column(name = &quot;scheduled_pickup_time&quot;)&#10;    private LocalDateTime scheduledPickupTime;&#10;    &#10;    @Column(name = &quot;actual_pickup_time&quot;)&#10;    private LocalDateTime actualPickupTime;&#10;    &#10;    @Column(name = &quot;estimated_delivery_time&quot;)&#10;    private LocalDateTime estimatedDeliveryTime;&#10;    &#10;    @Column(name = &quot;actual_delivery_time&quot;)&#10;    private LocalDateTime actualDeliveryTime;&#10;    &#10;    @Column(name = &quot;created_at&quot;)&#10;    private LocalDateTime createdAt;&#10;    &#10;    @Column(name = &quot;updated_at&quot;)&#10;    private LocalDateTime updatedAt;&#10;    &#10;    @PrePersist&#10;    protected void onCreate() {&#10;        createdAt = LocalDateTime.now();&#10;        updatedAt = LocalDateTime.now();&#10;        orderDate = LocalDateTime.now();&#10;        if (orderNumber == null) {&#10;            orderNumber = &quot;ORD-&quot; + System.currentTimeMillis();&#10;        }&#10;    }&#10;    &#10;    @PreUpdate&#10;    protected void onUpdate() {&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;    &#10;    // Enums&#10;    public enum OrderStatus {&#10;        PENDING, ASSIGNED, PICKED_UP, IN_TRANSIT, DELIVERED, CANCELLED&#10;    }&#10;    &#10;    public enum OrderPriority {&#10;        LOW, NORMAL, HIGH, URGENT&#10;    }&#10;    &#10;    public enum PaymentType {&#10;        CASH, CARD, ONLINE, BUSINESS_ACCOUNT&#10;    }&#10;    &#10;    // Constructors&#10;    public Order() {}&#10;    &#10;    public Order(Business business, String endCustomerName, String pickupAddress, String deliveryAddress, String packageDescription, BigDecimal deliveryFee) {&#10;        this.business = business;&#10;        this.endCustomerName = endCustomerName;&#10;        this.pickupAddress = pickupAddress;&#10;        this.deliveryAddress = deliveryAddress;&#10;        this.packageDescription = packageDescription;&#10;        this.deliveryFee = deliveryFee;&#10;    }&#10;    &#10;    // Getters and Setters&#10;    public Long getId() { return id; }&#10;    public void setId(Long id) { this.id = id; }&#10;    &#10;    public String getOrderNumber() { return orderNumber; }&#10;    public void setOrderNumber(String orderNumber) { this.orderNumber = orderNumber; }&#10;    &#10;    public OrderStatus getStatus() { return status; }&#10;    public void setStatus(OrderStatus status) { this.status = status; }&#10;    &#10;    public OrderPriority getPriority() { return priority; }&#10;    public void setPriority(OrderPriority priority) { this.priority = priority; }&#10;    &#10;    public Business getBusiness() { return business; }&#10;    public void setBusiness(Business business) { this.business = business; }&#10;    &#10;    public String getBusinessContactPerson() { return businessContactPerson; }&#10;    public void setBusinessContactPerson(String businessContactPerson) { this.businessContactPerson = businessContactPerson; }&#10;    &#10;    public String getBusinessPhone() { return businessPhone; }&#10;    public void setBusinessPhone(String businessPhone) { this.businessPhone = businessPhone; }&#10;    &#10;    public Courier getCourier() { return courier; }&#10;    public void setCourier(Courier courier) { this.courier = courier; }&#10;    &#10;    public Coordinator getCoordinator() { return coordinator; }&#10;    public void setCoordinator(Coordinator coordinator) { this.coordinator = coordinator; }&#10;    &#10;    public String getEndCustomerName() { return endCustomerName; }&#10;    public void setEndCustomerName(String endCustomerName) { this.endCustomerName = endCustomerName; }&#10;    &#10;    public String getEndCustomerPhone() { return endCustomerPhone; }&#10;    public void setEndCustomerPhone(String endCustomerPhone) { this.endCustomerPhone = endCustomerPhone; }&#10;    &#10;    public String getPickupAddress() { return pickupAddress; }&#10;    public void setPickupAddress(String pickupAddress) { this.pickupAddress = pickupAddress; }&#10;    &#10;    public String getPickupAddressDescription() { return pickupAddressDescription; }&#10;    public void setPickupAddressDescription(String pickupAddressDescription) { this.pickupAddressDescription = pickupAddressDescription; }&#10;    &#10;    public String getDeliveryAddress() { return deliveryAddress; }&#10;    public void setDeliveryAddress(String deliveryAddress) { this.deliveryAddress = deliveryAddress; }&#10;    &#10;    public String getDeliveryAddressDescription() { return deliveryAddressDescription; }&#10;    public void setDeliveryAddressDescription(String deliveryAddressDescription) { this.deliveryAddressDescription = deliveryAddressDescription; }&#10;    &#10;    public String getPackageDescription() { return packageDescription; }&#10;    public void setPackageDescription(String packageDescription) { this.packageDescription = packageDescription; }&#10;    &#10;    public Double getPackageWeight() { return packageWeight; }&#10;    public void setPackageWeight(Double packageWeight) { this.packageWeight = packageWeight; }&#10;    &#10;    public Integer getPackageCount() { return packageCount; }&#10;    public void setPackageCount(Integer packageCount) { this.packageCount = packageCount; }&#10;    &#10;    public BigDecimal getDeliveryFee() { return deliveryFee; }&#10;    public void setDeliveryFee(BigDecimal deliveryFee) { this.deliveryFee = deliveryFee; }&#10;    &#10;    public BigDecimal getCollectionAmount() { return collectionAmount; }&#10;    public void setCollectionAmount(BigDecimal collectionAmount) { this.collectionAmount = collectionAmount; }&#10;    &#10;    public PaymentType getPaymentType() { return paymentType; }&#10;    public void setPaymentType(PaymentType paymentType) { this.paymentType = paymentType; }&#10;    &#10;    public String getCourierNotes() { return courierNotes; }&#10;    public void setCourierNotes(String courierNotes) { this.courierNotes = courierNotes; }&#10;    &#10;    public String getBusinessNotes() { return businessNotes; }&#10;    public void setBusinessNotes(String businessNotes) { this.businessNotes = businessNotes; }&#10;    &#10;    public String getReceiptImageUrl() { return receiptImageUrl; }&#10;    public void setReceiptImageUrl(String receiptImageUrl) { this.receiptImageUrl = receiptImageUrl; }&#10;    &#10;    public String getDeliveryProofUrl() { return deliveryProofUrl; }&#10;    public void setDeliveryProofUrl(String deliveryProofUrl) { this.deliveryProofUrl = deliveryProofUrl; }&#10;    &#10;    public LocalDateTime getOrderDate() { return orderDate; }&#10;    public void setOrderDate(LocalDateTime orderDate) { this.orderDate = orderDate; }&#10;    &#10;    public LocalDateTime getScheduledPickupTime() { return scheduledPickupTime; }&#10;    public void setScheduledPickupTime(LocalDateTime scheduledPickupTime) { this.scheduledPickupTime = scheduledPickupTime; }&#10;    &#10;    public LocalDateTime getActualPickupTime() { return actualPickupTime; }&#10;    public void setActualPickupTime(LocalDateTime actualPickupTime) { this.actualPickupTime = actualPickupTime; }&#10;    &#10;    public LocalDateTime getEstimatedDeliveryTime() { return estimatedDeliveryTime; }&#10;    public void setEstimatedDeliveryTime(LocalDateTime estimatedDeliveryTime) { this.estimatedDeliveryTime = estimatedDeliveryTime; }&#10;    &#10;    public LocalDateTime getActualDeliveryTime() { return actualDeliveryTime; }&#10;    public void setActualDeliveryTime(LocalDateTime actualDeliveryTime) { this.actualDeliveryTime = actualDeliveryTime; }&#10;    &#10;    public LocalDateTime getCreatedAt() { return createdAt; }&#10;    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }&#10;    &#10;    public LocalDateTime getUpdatedAt() { return updatedAt; }&#10;    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }&#10;    &#10;    // Additional getters for convenience&#10;    public Double getPickupLatitude() { return pickupLatitude; }&#10;    public void setPickupLatitude(Double pickupLatitude) { this.pickupLatitude = pickupLatitude; }&#10;    &#10;    public Double getPickupLongitude() { return pickupLongitude; }&#10;    public void setPickupLongitude(Double pickupLongitude) { this.pickupLongitude = pickupLongitude; }&#10;    &#10;    public String getPickupLocationName() { return pickupLocationName; }&#10;    public void setPickupLocationName(String pickupLocationName) { this.pickupLocationName = pickupLocationName; }&#10;    &#10;    public String getPickupContactPerson() { return pickupContactPerson; }&#10;    public void setPickupContactPerson(String pickupContactPerson) { this.pickupContactPerson = pickupContactPerson; }&#10;    &#10;    public Double getDeliveryLatitude() { return deliveryLatitude; }&#10;    public void setDeliveryLatitude(Double deliveryLatitude) { this.deliveryLatitude = deliveryLatitude; }&#10;    &#10;    public Double getDeliveryLongitude() { return deliveryLongitude; }&#10;    public void setDeliveryLongitude(Double deliveryLongitude) { this.deliveryLongitude = deliveryLongitude; }&#10;    &#10;    public String getDeliveryLocationName() { return deliveryLocationName; }&#10;    public void setDeliveryLocationName(String deliveryLocationName) { this.deliveryLocationName = deliveryLocationName; }&#10;    &#10;    public BigDecimal getPackageValue() { return packageValue; }&#10;    public void setPackageValue(BigDecimal packageValue) { this.packageValue = packageValue; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/OrderTracking.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/OrderTracking.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/SystemUser.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/SystemUser.java" />
              <option name="updatedContent" value="package com.api.demo.entity;&#10;&#10;import jakarta.persistence.*;&#10;import java.time.LocalDateTime;&#10;&#10;@Entity&#10;@Table(name = &quot;system_users&quot;)&#10;public class SystemUser {&#10;    &#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;    &#10;    @Column(name = &quot;username&quot;, unique = true, nullable = false, length = 50)&#10;    private String username;&#10;    &#10;    @Column(name = &quot;email&quot;, unique = true, nullable = false, length = 100)&#10;    private String email;&#10;    &#10;    @Column(name = &quot;password&quot;, nullable = false)&#10;    private String password;&#10;    &#10;    @Column(name = &quot;first_name&quot;, length = 50)&#10;    private String firstName;&#10;    &#10;    @Column(name = &quot;last_name&quot;, length = 50)&#10;    private String lastName;&#10;    &#10;    @Column(name = &quot;phone&quot;, length = 20)&#10;    private String phone;&#10;    &#10;    @Enumerated(EnumType.STRING)&#10;    @Column(name = &quot;role&quot;, nullable = false)&#10;    private UserRole role;&#10;    &#10;    @Column(name = &quot;is_active&quot;)&#10;    private Boolean isActive = true;&#10;    &#10;    @Column(name = &quot;created_at&quot;)&#10;    private LocalDateTime createdAt;&#10;    &#10;    @Column(name = &quot;updated_at&quot;)&#10;    private LocalDateTime updatedAt;&#10;    &#10;    @PrePersist&#10;    protected void onCreate() {&#10;        createdAt = LocalDateTime.now();&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;    &#10;    @PreUpdate&#10;    protected void onUpdate() {&#10;        updatedAt = LocalDateTime.now();&#10;    }&#10;    &#10;    // Enum for system user roles&#10;    public enum UserRole {&#10;        ADMIN,          // Sistem yöneticisi&#10;        COORDINATOR,    // Koordinatör/Takım kaptanı&#10;        COURIER         // Kurye&#10;    }&#10;    &#10;    // Constructors&#10;    public SystemUser() {}&#10;    &#10;    public SystemUser(String username, String email, String password, UserRole role) {&#10;        this.username = username;&#10;        this.email = email;&#10;        this.password = password;&#10;        this.role = role;&#10;    }&#10;    &#10;    // Getters and Setters&#10;    public Long getId() { return id; }&#10;    public void setId(Long id) { this.id = id; }&#10;    &#10;    public String getUsername() { return username; }&#10;    public void setUsername(String username) { this.username = username; }&#10;    &#10;    public String getEmail() { return email; }&#10;    public void setEmail(String email) { this.email = email; }&#10;    &#10;    public String getPassword() { return password; }&#10;    public void setPassword(String password) { this.password = password; }&#10;    &#10;    public String getFirstName() { return firstName; }&#10;    public void setFirstName(String firstName) { this.firstName = firstName; }&#10;    &#10;    public String getLastName() { return lastName; }&#10;    public void setLastName(String lastName) { this.lastName = lastName; }&#10;    &#10;    public String getPhone() { return phone; }&#10;    public void setPhone(String phone) { this.phone = phone; }&#10;    &#10;    public UserRole getRole() { return role; }&#10;    public void setRole(UserRole role) { this.role = role; }&#10;    &#10;    public Boolean getIsActive() { return isActive; }&#10;    public void setIsActive(Boolean isActive) { this.isActive = isActive; }&#10;    &#10;    public LocalDateTime getCreatedAt() { return createdAt; }&#10;    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }&#10;    &#10;    public LocalDateTime getUpdatedAt() { return updatedAt; }&#10;    public void setUpdatedAt(LocalDateTime updatedAt) { this.updatedAt = updatedAt; }&#10;    &#10;    // Helper methods&#10;    public String getFullName() {&#10;        return (firstName != null ? firstName : &quot;&quot;) + &quot; &quot; + (lastName != null ? lastName : &quot;&quot;);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/User.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/User.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Vehicle.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/entity/Vehicle.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/exception/GlobalExceptionHandler.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/exception/GlobalExceptionHandler.java" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/repository/CourierRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/repository/CourierRepository.java" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="package com.api.demo.repository;&#10;&#10;import com.api.demo.entity.Courier;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.data.jpa.repository.Query;&#10;import org.springframework.stereotype.Repository;&#10;import java.util.List;&#10;import java.util.Optional;&#10;&#10;@Repository&#10;public interface CourierRepository extends JpaRepository&lt;Courier, Long&gt; {&#10;    &#10;    // Basic CRUD operations are inherited from JpaRepository&#10;    &#10;    // Custom query methods&#10;    Optional&lt;Courier&gt; findByEmail(String email);&#10;    &#10;    List&lt;Courier&gt; findByIsAvailable(Boolean isAvailable);&#10;    &#10;    @Query(&quot;SELECT c FROM Courier c WHERE c.name LIKE %?1%&quot;)&#10;    List&lt;Courier&gt; findByNameContaining(String name);&#10;    &#10;    @Query(&quot;SELECT COUNT(c) FROM Courier c WHERE c.isAvailable = true&quot;)&#10;    Long countAvailableCouriers();&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/service/CourierEventService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/service/CourierEventService.java" />
              <option name="originalContent" value="package com.api.demo.service;&#10;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.kafka.annotation.KafkaListener;&#10;import org.springframework.kafka.core.KafkaTemplate;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDateTime;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@Service&#10;public class CourierEventService {&#10;&#10;    @Autowired&#10;    private KafkaTemplate&lt;String, Object&gt; kafkaTemplate;&#10;&#10;    @Autowired&#10;    private CourierQueueService courierQueueService;&#10;&#10;    @Autowired&#10;    private OrderAssignmentService orderAssignmentService;&#10;&#10;    /**&#10;     * Kurye vardiya durumu değişikliklerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;courier-status-changes&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleCourierStatusChange(Map&lt;String, Object&gt; statusChange) {&#10;        Long courierId = Long.valueOf(statusChange.get(&quot;courierId&quot;).toString());&#10;        String newStatus = statusChange.get(&quot;status&quot;).toString();&#10;&#10;        switch (newStatus) {&#10;            case &quot;ONLINE&quot;:&#10;                // Kurye vardiyaya girdi - sıraya ekle&#10;                courierQueueService.addCourierToQueue(courierId);&#10;                courierQueueService.updateCourierStatus(courierId, &quot;AVAILABLE&quot;);&#10;&#10;                // Bekleyen siparişleri kontrol et&#10;                orderAssignmentService.processPendingOrdersForAvailableCourier(courierId);&#10;&#10;                sendNotification(&quot;courier-events&quot;, &quot;Courier &quot; + courierId + &quot; joined the queue&quot;);&#10;                break;&#10;&#10;            case &quot;OFFLINE&quot;:&#10;                // Kurye vardiyadan çıktı - sıradan çıkar&#10;                courierQueueService.removeCourierFromQueue(courierId);&#10;                sendNotification(&quot;courier-events&quot;, &quot;Courier &quot; + courierId + &quot; left the queue&quot;);&#10;                break;&#10;&#10;            case &quot;AVAILABLE&quot;:&#10;                // Kurye müsait oldu - bekleyen siparişleri kontrol et&#10;                courierQueueService.updateCourierStatus(courierId, &quot;AVAILABLE&quot;);&#10;                orderAssignmentService.processPendingOrdersForAvailableCourier(courierId);&#10;                break;&#10;&#10;            case &quot;BUSY&quot;:&#10;                // Kurye meşgul&#10;                courierQueueService.updateCourierStatus(courierId, &quot;BUSY&quot;);&#10;                break;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Sipariş durumu değişikliklerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;order-status-changes&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleOrderStatusChange(Map&lt;String, Object&gt; orderUpdate) {&#10;        String orderStatus = orderUpdate.get(&quot;status&quot;).toString();&#10;        Long orderId = Long.valueOf(orderUpdate.get(&quot;orderId&quot;).toString());&#10;        Long courierId = orderUpdate.get(&quot;courierId&quot;) != null ?&#10;            Long.valueOf(orderUpdate.get(&quot;courierId&quot;).toString()) : null;&#10;&#10;        switch (orderStatus) {&#10;            case &quot;DELIVERED&quot;:&#10;            case &quot;CANCELLED&quot;:&#10;                if (courierId != null) {&#10;                    // Kurye tekrar müsait oldu&#10;                    courierQueueService.updateCourierStatus(courierId, &quot;AVAILABLE&quot;);&#10;&#10;                    // Bekleyen siparişleri kontrol et&#10;                    orderAssignmentService.processPendingOrdersForAvailableCourier(courierId);&#10;                }&#10;                break;&#10;&#10;            case &quot;PICKED_UP&quot;:&#10;                if (courierId != null) {&#10;                    courierQueueService.updateCourierStatus(courierId, &quot;IN_DELIVERY&quot;);&#10;                }&#10;                break;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Lokasyon güncellemelerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;courier-location-updates&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleLocationUpdate(Map&lt;String, Object&gt; locationUpdate) {&#10;        Long courierId = Long.valueOf(locationUpdate.get(&quot;courierId&quot;).toString());&#10;        Double latitude = Double.valueOf(locationUpdate.get(&quot;latitude&quot;).toString());&#10;        Double longitude = Double.valueOf(locationUpdate.get(&quot;longitude&quot;).toString());&#10;&#10;        // Redis'te lokasyonu güncelle&#10;        courierQueueService.updateCourierLocation(courierId, latitude, longitude);&#10;&#10;        // Yakındaki bekleyen siparişleri kontrol et ve bildirim gönder&#10;        checkNearbyPendingOrders(courierId, latitude, longitude);&#10;    }&#10;&#10;    /**&#10;     * Toplu optimizasyon isteklerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;bulk-optimization&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleBulkOptimization(Map&lt;String, Object&gt; optimizationRequest) {&#10;        // Toplu optimizasyon algoritmasını çalıştır&#10;        int pendingCount = Integer.parseInt(optimizationRequest.get(&quot;pendingOrders&quot;).toString());&#10;        int availableCount = Integer.parseInt(optimizationRequest.get(&quot;availableCouriers&quot;).toString());&#10;&#10;        if (pendingCount &gt; 10 &amp;&amp; availableCount &gt; 3) {&#10;            // Gelişmiş optimizasyon algoritması&#10;            performAdvancedOptimization();&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya başlangıcını tetikler&#10;     */&#10;    public void startCourierShift(Long courierId) {&#10;        Map&lt;String, Object&gt; statusChange = new HashMap&lt;&gt;();&#10;        statusChange.put(&quot;courierId&quot;, courierId);&#10;        statusChange.put(&quot;status&quot;, &quot;ONLINE&quot;);&#10;        statusChange.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;        statusChange.put(&quot;action&quot;, &quot;SHIFT_START&quot;);&#10;&#10;        kafkaTemplate.send(&quot;courier-status-changes&quot;, statusChange);&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya bitişini tetikler&#10;     */&#10;    public void endCourierShift(Long courierId) {&#10;        Map&lt;String, Object&gt; statusChange = new HashMap&lt;&gt;();&#10;        statusChange.put(&quot;courierId&quot;, courierId);&#10;        statusChange.put(&quot;status&quot;, &quot;OFFLINE&quot;);&#10;        statusChange.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;        statusChange.put(&quot;action&quot;, &quot;SHIFT_END&quot;);&#10;&#10;        kafkaTemplate.send(&quot;courier-status-changes&quot;, statusChange);&#10;    }&#10;&#10;    /**&#10;     * Kurye lokasyon güncellemesi gönderir&#10;     */&#10;    public void updateCourierLocation(Long courierId, double latitude, double longitude) {&#10;        Map&lt;String, Object&gt; locationUpdate = new HashMap&lt;&gt;();&#10;        locationUpdate.put(&quot;courierId&quot;, courierId);&#10;        locationUpdate.put(&quot;latitude&quot;, latitude);&#10;        locationUpdate.put(&quot;longitude&quot;, longitude);&#10;        locationUpdate.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;courier-location-updates&quot;, locationUpdate);&#10;    }&#10;&#10;    /**&#10;     * Sipariş durumu güncellemesi gönderir&#10;     */&#10;    public void updateOrderStatus(Long orderId, Long courierId, String status) {&#10;        Map&lt;String, Object&gt; orderUpdate = new HashMap&lt;&gt;();&#10;        orderUpdate.put(&quot;orderId&quot;, orderId);&#10;        orderUpdate.put(&quot;courierId&quot;, courierId);&#10;        orderUpdate.put(&quot;status&quot;, status);&#10;        orderUpdate.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;order-status-changes&quot;, orderUpdate);&#10;    }&#10;&#10;    /**&#10;     * Yeni sipariş bildirimi gönderir&#10;     */&#10;    public void notifyNewOrder(Long orderId, String businessName, String priority) {&#10;        Map&lt;String, Object&gt; notification = new HashMap&lt;&gt;();&#10;        notification.put(&quot;type&quot;, &quot;NEW_ORDER&quot;);&#10;        notification.put(&quot;orderId&quot;, orderId);&#10;        notification.put(&quot;businessName&quot;, businessName);&#10;        notification.put(&quot;priority&quot;, priority);&#10;        notification.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;new-orders&quot;, notification);&#10;&#10;        // Otomatik atama için&#10;        kafkaTemplate.send(&quot;auto-assignment-requests&quot;, notification);&#10;    }&#10;&#10;    // Yardımcı metodlar&#10;    private void checkNearbyPendingOrders(Long courierId, double latitude, double longitude) {&#10;        // Yakındaki bekleyen siparişleri kontrol et&#10;        // Bu işlem için ayrı bir background service kullanılabilir&#10;        Map&lt;String, Object&gt; proximityCheck = new HashMap&lt;&gt;();&#10;        proximityCheck.put(&quot;courierId&quot;, courierId);&#10;        proximityCheck.put(&quot;latitude&quot;, latitude);&#10;        proximityCheck.put(&quot;longitude&quot;, longitude);&#10;        proximityCheck.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;proximity-checks&quot;, proximityCheck);&#10;    }&#10;&#10;    private void performAdvancedOptimization() {&#10;        // Gelişmiş optimizasyon algoritması&#10;        Map&lt;String, Object&gt; optimizationResult = new HashMap&lt;&gt;();&#10;        optimizationResult.put(&quot;type&quot;, &quot;ADVANCED_OPTIMIZATION&quot;);&#10;        optimizationResult.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;        optimizationResult.put(&quot;status&quot;, &quot;STARTED&quot;);&#10;&#10;        kafkaTemplate.send(&quot;optimization-results&quot;, optimizationResult);&#10;    }&#10;&#10;    private void sendNotification(String topic, String message) {&#10;        Map&lt;String, Object&gt; notification = new HashMap&lt;&gt;();&#10;        notification.put(&quot;message&quot;, message);&#10;        notification.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(topic, notification);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.api.demo.service;&#10;&#10;import org.springframework.kafka.annotation.KafkaListener;&#10;import org.springframework.kafka.core.KafkaTemplate;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDateTime;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;&#10;@Service&#10;public class CourierEventService {&#10;&#10;    private final KafkaTemplate&lt;String, Object&gt; kafkaTemplate;&#10;    private final CourierQueueService courierQueueService;&#10;    private final OrderAssignmentService orderAssignmentService;&#10;&#10;    public CourierEventService(&#10;            KafkaTemplate&lt;String, Object&gt; kafkaTemplate,&#10;            CourierQueueService courierQueueService,&#10;            OrderAssignmentService orderAssignmentService) {&#10;        this.kafkaTemplate = kafkaTemplate;&#10;        this.courierQueueService = courierQueueService;&#10;        this.orderAssignmentService = orderAssignmentService;&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya durumu değişikliklerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;courier-status-changes&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleCourierStatusChange(Map&lt;String, Object&gt; statusChange) {&#10;        Long courierId = Long.valueOf(statusChange.get(&quot;courierId&quot;).toString());&#10;        String newStatus = statusChange.get(&quot;status&quot;).toString();&#10;&#10;        switch (newStatus) {&#10;            case &quot;ONLINE&quot;:&#10;                // Kurye vardiyaya girdi - sıraya ekle&#10;                courierQueueService.addCourierToQueue(courierId);&#10;                courierQueueService.updateCourierStatus(courierId, &quot;AVAILABLE&quot;);&#10;&#10;                // Bekleyen siparişleri kontrol et&#10;                orderAssignmentService.processPendingOrdersForAvailableCourier(courierId);&#10;&#10;                sendNotification(&quot;courier-events&quot;, &quot;Courier &quot; + courierId + &quot; joined the queue&quot;);&#10;                break;&#10;&#10;            case &quot;OFFLINE&quot;:&#10;                // Kurye vardiyadan çıktı - sıradan çıkar&#10;                courierQueueService.removeCourierFromQueue(courierId);&#10;                sendNotification(&quot;courier-events&quot;, &quot;Courier &quot; + courierId + &quot; left the queue&quot;);&#10;                break;&#10;&#10;            case &quot;AVAILABLE&quot;:&#10;                // Kurye müsait oldu - bekleyen siparişleri kontrol et&#10;                courierQueueService.updateCourierStatus(courierId, &quot;AVAILABLE&quot;);&#10;                orderAssignmentService.processPendingOrdersForAvailableCourier(courierId);&#10;                break;&#10;&#10;            case &quot;BUSY&quot;:&#10;                // Kurye meşgul&#10;                courierQueueService.updateCourierStatus(courierId, &quot;BUSY&quot;);&#10;                break;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Sipariş durumu değişikliklerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;order-status-changes&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleOrderStatusChange(Map&lt;String, Object&gt; orderUpdate) {&#10;        String orderStatus = orderUpdate.get(&quot;status&quot;).toString();&#10;        Long orderId = Long.valueOf(orderUpdate.get(&quot;orderId&quot;).toString());&#10;        Long courierId = orderUpdate.get(&quot;courierId&quot;) != null ?&#10;            Long.valueOf(orderUpdate.get(&quot;courierId&quot;).toString()) : null;&#10;&#10;        switch (orderStatus) {&#10;            case &quot;DELIVERED&quot;:&#10;            case &quot;CANCELLED&quot;:&#10;                if (courierId != null) {&#10;                    // Kurye tekrar müsait oldu&#10;                    courierQueueService.updateCourierStatus(courierId, &quot;AVAILABLE&quot;);&#10;&#10;                    // Bekleyen siparişleri kontrol et&#10;                    orderAssignmentService.processPendingOrdersForAvailableCourier(courierId);&#10;                }&#10;                break;&#10;&#10;            case &quot;PICKED_UP&quot;:&#10;                if (courierId != null) {&#10;                    courierQueueService.updateCourierStatus(courierId, &quot;IN_DELIVERY&quot;);&#10;                }&#10;                break;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Lokasyon güncellemelerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;courier-location-updates&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleLocationUpdate(Map&lt;String, Object&gt; locationUpdate) {&#10;        Long courierId = Long.valueOf(locationUpdate.get(&quot;courierId&quot;).toString());&#10;        Double latitude = Double.valueOf(locationUpdate.get(&quot;latitude&quot;).toString());&#10;        Double longitude = Double.valueOf(locationUpdate.get(&quot;longitude&quot;).toString());&#10;&#10;        // Redis'te lokasyonu güncelle&#10;        courierQueueService.updateCourierLocation(courierId, latitude, longitude);&#10;&#10;        // Yakındaki bekleyen siparişleri kontrol et ve bildirim gönder&#10;        checkNearbyPendingOrders(courierId, latitude, longitude);&#10;    }&#10;&#10;    /**&#10;     * Toplu optimizasyon isteklerini dinler&#10;     */&#10;    @KafkaListener(topics = &quot;bulk-optimization&quot;, groupId = &quot;courier-service&quot;)&#10;    public void handleBulkOptimization(Map&lt;String, Object&gt; optimizationRequest) {&#10;        // Toplu optimizasyon algoritmasını çalıştır&#10;        int pendingCount = Integer.parseInt(optimizationRequest.get(&quot;pendingOrders&quot;).toString());&#10;        int availableCount = Integer.parseInt(optimizationRequest.get(&quot;availableCouriers&quot;).toString());&#10;&#10;        if (pendingCount &gt; 10 &amp;&amp; availableCount &gt; 3) {&#10;            // Gelişmiş optimizasyon algoritması&#10;            performAdvancedOptimization();&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya başlangıcını tetikler&#10;     */&#10;    public void startCourierShift(Long courierId) {&#10;        Map&lt;String, Object&gt; statusChange = new HashMap&lt;&gt;();&#10;        statusChange.put(&quot;courierId&quot;, courierId);&#10;        statusChange.put(&quot;status&quot;, &quot;ONLINE&quot;);&#10;        statusChange.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;        statusChange.put(&quot;action&quot;, &quot;SHIFT_START&quot;);&#10;&#10;        kafkaTemplate.send(&quot;courier-status-changes&quot;, statusChange);&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiya bitişini tetikler&#10;     */&#10;    public void endCourierShift(Long courierId) {&#10;        Map&lt;String, Object&gt; statusChange = new HashMap&lt;&gt;();&#10;        statusChange.put(&quot;courierId&quot;, courierId);&#10;        statusChange.put(&quot;status&quot;, &quot;OFFLINE&quot;);&#10;        statusChange.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;        statusChange.put(&quot;action&quot;, &quot;SHIFT_END&quot;);&#10;&#10;        kafkaTemplate.send(&quot;courier-status-changes&quot;, statusChange);&#10;    }&#10;&#10;    /**&#10;     * Kurye lokasyon güncellemesi gönderir&#10;     */&#10;    public void updateCourierLocation(Long courierId, double latitude, double longitude) {&#10;        Map&lt;String, Object&gt; locationUpdate = new HashMap&lt;&gt;();&#10;        locationUpdate.put(&quot;courierId&quot;, courierId);&#10;        locationUpdate.put(&quot;latitude&quot;, latitude);&#10;        locationUpdate.put(&quot;longitude&quot;, longitude);&#10;        locationUpdate.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;courier-location-updates&quot;, locationUpdate);&#10;    }&#10;&#10;    /**&#10;     * Sipariş durumu güncellemesi gönderir&#10;     */&#10;    public void updateOrderStatus(Long orderId, Long courierId, String status) {&#10;        Map&lt;String, Object&gt; orderUpdate = new HashMap&lt;&gt;();&#10;        orderUpdate.put(&quot;orderId&quot;, orderId);&#10;        orderUpdate.put(&quot;courierId&quot;, courierId);&#10;        orderUpdate.put(&quot;status&quot;, status);&#10;        orderUpdate.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;order-status-changes&quot;, orderUpdate);&#10;    }&#10;&#10;    /**&#10;     * Yeni sipariş bildirimi gönderir&#10;     */&#10;    public void notifyNewOrder(Long orderId, String businessName, String priority) {&#10;        Map&lt;String, Object&gt; notification = new HashMap&lt;&gt;();&#10;        notification.put(&quot;type&quot;, &quot;NEW_ORDER&quot;);&#10;        notification.put(&quot;orderId&quot;, orderId);&#10;        notification.put(&quot;businessName&quot;, businessName);&#10;        notification.put(&quot;priority&quot;, priority);&#10;        notification.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;new-orders&quot;, notification);&#10;&#10;        // Otomatik atama için&#10;        kafkaTemplate.send(&quot;auto-assignment-requests&quot;, notification);&#10;    }&#10;&#10;    // Yardımcı metodlar&#10;    private void checkNearbyPendingOrders(Long courierId, double latitude, double longitude) {&#10;        // Yakındaki bekleyen siparişleri kontrol et&#10;        // Bu işlem için ayrı bir background service kullanılabilir&#10;        Map&lt;String, Object&gt; proximityCheck = new HashMap&lt;&gt;();&#10;        proximityCheck.put(&quot;courierId&quot;, courierId);&#10;        proximityCheck.put(&quot;latitude&quot;, latitude);&#10;        proximityCheck.put(&quot;longitude&quot;, longitude);&#10;        proximityCheck.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;proximity-checks&quot;, proximityCheck);&#10;    }&#10;&#10;    private void performAdvancedOptimization() {&#10;        // Gelişmiş optimizasyon algoritması&#10;        Map&lt;String, Object&gt; optimizationResult = new HashMap&lt;&gt;();&#10;        optimizationResult.put(&quot;type&quot;, &quot;ADVANCED_OPTIMIZATION&quot;);&#10;        optimizationResult.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;        optimizationResult.put(&quot;status&quot;, &quot;STARTED&quot;);&#10;&#10;        kafkaTemplate.send(&quot;optimization-results&quot;, optimizationResult);&#10;    }&#10;&#10;    private void sendNotification(String topic, String message) {&#10;        Map&lt;String, Object&gt; notification = new HashMap&lt;&gt;();&#10;        notification.put(&quot;message&quot;, message);&#10;        notification.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(topic, notification);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/service/CourierQueueService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/service/CourierQueueService.java" />
              <option name="originalContent" value="package com.api.demo.service;&#10;&#10;import com.api.demo.entity.Courier;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.data.redis.core.RedisTemplate;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDateTime;&#10;import java.util.List;&#10;import java.util.Set;&#10;&#10;@Service&#10;public class CourierQueueService {&#10;&#10;    @Autowired&#10;    private RedisTemplate&lt;String, Object&gt; redisTemplate;&#10;&#10;    private static final String COURIER_QUEUE_KEY = &quot;courier:queue&quot;;&#10;    private static final String COURIER_STATUS_KEY = &quot;courier:status:&quot;;&#10;    private static final String COURIER_LOCATION_KEY = &quot;courier:location:&quot;;&#10;    private static final String COURIER_CURRENT_INDEX_KEY = &quot;courier:current:index&quot;;&#10;&#10;    /**&#10;     * Kurye vardiyaya girdiğinde sıraya ekler&#10;     */&#10;    public void addCourierToQueue(Long courierId) {&#10;        // Kurye zaten sırada mı kontrol et&#10;        if (!isCourierInQueue(courierId)) {&#10;            // Sıranın sonuna ekle&#10;            redisTemplate.opsForList().rightPush(COURIER_QUEUE_KEY, courierId);&#10;&#10;            // Kurye durumunu aktif yap&#10;            redisTemplate.opsForValue().set(&#10;                COURIER_STATUS_KEY + courierId,&#10;                &quot;AVAILABLE&quot;,&#10;                java.time.Duration.ofHours(12) // 12 saat cache&#10;            );&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiyadan çıktığında sıradan çıkarır&#10;     */&#10;    public void removeCourierFromQueue(Long courierId) {&#10;        redisTemplate.opsForList().remove(COURIER_QUEUE_KEY, 0, courierId);&#10;        redisTemplate.delete(COURIER_STATUS_KEY + courierId);&#10;        redisTemplate.delete(COURIER_LOCATION_KEY + courierId);&#10;    }&#10;&#10;    /**&#10;     * Sıradaki bir sonraki müsait kuryeyi getirir (Round Robin)&#10;     */&#10;    public Long getNextAvailableCourier() {&#10;        List&lt;Object&gt; courierQueue = redisTemplate.opsForList().range(COURIER_QUEUE_KEY, 0, -1);&#10;&#10;        if (courierQueue == null || courierQueue.isEmpty()) {&#10;            return null;&#10;        }&#10;&#10;        // Mevcut sıra indeksini al&#10;        Integer currentIndex = (Integer) redisTemplate.opsForValue().get(COURIER_CURRENT_INDEX_KEY);&#10;        if (currentIndex == null) {&#10;            currentIndex = 0;&#10;        }&#10;&#10;        // Sırayı dolaşarak müsait kurye bul&#10;        int startIndex = currentIndex;&#10;        int queueSize = courierQueue.size();&#10;&#10;        for (int i = 0; i &lt; queueSize; i++) {&#10;            int checkIndex = (startIndex + i) % queueSize;&#10;            Long courierId = Long.valueOf(courierQueue.get(checkIndex).toString());&#10;&#10;            if (isCourierAvailable(courierId)) {&#10;                // Sıra indeksini güncelle (bir sonraki kuryeyi işaret etsin)&#10;                int nextIndex = (checkIndex + 1) % queueSize;&#10;                redisTemplate.opsForValue().set(COURIER_CURRENT_INDEX_KEY, nextIndex);&#10;&#10;                return courierId;&#10;            }&#10;        }&#10;&#10;        return null; // Hiç müsait kurye yok&#10;    }&#10;&#10;    /**&#10;     * Kurye müsait mi kontrol eder&#10;     */&#10;    public boolean isCourierAvailable(Long courierId) {&#10;        String status = (String) redisTemplate.opsForValue().get(COURIER_STATUS_KEY + courierId);&#10;        return &quot;AVAILABLE&quot;.equals(status);&#10;    }&#10;&#10;    /**&#10;     * Kurye durumunu günceller&#10;     */&#10;    public void updateCourierStatus(Long courierId, String status) {&#10;        redisTemplate.opsForValue().set(&#10;            COURIER_STATUS_KEY + courierId,&#10;            status,&#10;            java.time.Duration.ofHours(12)&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Kurye lokasyonunu günceller&#10;     */&#10;    public void updateCourierLocation(Long courierId, double latitude, double longitude) {&#10;        String locationData = latitude + &quot;,&quot; + longitude + &quot;,&quot; + LocalDateTime.now();&#10;        redisTemplate.opsForValue().set(&#10;            COURIER_LOCATION_KEY + courierId,&#10;            locationData,&#10;            java.time.Duration.ofHours(2)&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Kurye sırada mı kontrol eder&#10;     */&#10;    public boolean isCourierInQueue(Long courierId) {&#10;        List&lt;Object&gt; courierQueue = redisTemplate.opsForList().range(COURIER_QUEUE_KEY, 0, -1);&#10;        return courierQueue != null &amp;&amp; courierQueue.contains(courierId);&#10;    }&#10;&#10;    /**&#10;     * Aktif kurye sırasını getirir&#10;     */&#10;    public List&lt;Object&gt; getCourierQueue() {&#10;        return redisTemplate.opsForList().range(COURIER_QUEUE_KEY, 0, -1);&#10;    }&#10;&#10;    /**&#10;     * Sırayı temizler (debug/admin için)&#10;     */&#10;    public void clearQueue() {&#10;        redisTemplate.delete(COURIER_QUEUE_KEY);&#10;        redisTemplate.delete(COURIER_CURRENT_INDEX_KEY);&#10;    }&#10;&#10;    /**&#10;     * Sıra istatistiklerini getirir&#10;     */&#10;    public QueueStatistics getQueueStatistics() {&#10;        List&lt;Object&gt; queue = getCourierQueue();&#10;        int totalCouriers = queue != null ? queue.size() : 0;&#10;&#10;        long availableCouriers = 0;&#10;        if (queue != null) {&#10;            availableCouriers = queue.stream()&#10;                .mapToLong(id -&gt; Long.valueOf(id.toString()))&#10;                .mapToInt(id -&gt; isCourierAvailable(id) ? 1 : 0)&#10;                .sum();&#10;        }&#10;&#10;        Integer currentIndex = (Integer) redisTemplate.opsForValue().get(COURIER_CURRENT_INDEX_KEY);&#10;&#10;        return new QueueStatistics(totalCouriers, (int) availableCouriers, currentIndex != null ? currentIndex : 0);&#10;    }&#10;&#10;    // İstatistik sınıfı&#10;    public static class QueueStatistics {&#10;        private int totalCouriers;&#10;        private int availableCouriers;&#10;        private int currentIndex;&#10;&#10;        public QueueStatistics(int totalCouriers, int availableCouriers, int currentIndex) {&#10;            this.totalCouriers = totalCouriers;&#10;            this.availableCouriers = availableCouriers;&#10;            this.currentIndex = currentIndex;&#10;        }&#10;&#10;        // Getters&#10;        public int getTotalCouriers() { return totalCouriers; }&#10;        public int getAvailableCouriers() { return availableCouriers; }&#10;        public int getCurrentIndex() { return currentIndex; }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.api.demo.service;&#10;&#10;import com.api.demo.entity.Courier;&#10;import org.springframework.data.redis.core.RedisTemplate;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDateTime;&#10;import java.util.List;&#10;import java.util.Set;&#10;&#10;@Service&#10;public class CourierQueueService {&#10;&#10;    private final RedisTemplate&lt;String, Object&gt; redisTemplate;&#10;&#10;    public CourierQueueService(RedisTemplate&lt;String, Object&gt; redisTemplate) {&#10;        this.redisTemplate = redisTemplate;&#10;    }&#10;&#10;    private static final String COURIER_QUEUE_KEY = &quot;courier:queue&quot;;&#10;    private static final String COURIER_STATUS_KEY = &quot;courier:status:&quot;;&#10;    private static final String COURIER_LOCATION_KEY = &quot;courier:location:&quot;;&#10;    private static final String COURIER_CURRENT_INDEX_KEY = &quot;courier:current:index&quot;;&#10;&#10;    /**&#10;     * Kurye vardiyaya girdiğinde sıraya ekler&#10;     */&#10;    public void addCourierToQueue(Long courierId) {&#10;        // Kurye zaten sırada mı kontrol et&#10;        if (!isCourierInQueue(courierId)) {&#10;            // Sıranın sonuna ekle&#10;            redisTemplate.opsForList().rightPush(COURIER_QUEUE_KEY, courierId);&#10;&#10;            // Kurye durumunu aktif yap&#10;            redisTemplate.opsForValue().set(&#10;                COURIER_STATUS_KEY + courierId,&#10;                &quot;AVAILABLE&quot;,&#10;                java.time.Duration.ofHours(12) // 12 saat cache&#10;            );&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Kurye vardiyadan çıktığında sıradan çıkarır&#10;     */&#10;    public void removeCourierFromQueue(Long courierId) {&#10;        redisTemplate.opsForList().remove(COURIER_QUEUE_KEY, 0, courierId);&#10;        redisTemplate.delete(COURIER_STATUS_KEY + courierId);&#10;        redisTemplate.delete(COURIER_LOCATION_KEY + courierId);&#10;    }&#10;&#10;    /**&#10;     * Sıradaki bir sonraki müsait kuryeyi getirir (Round Robin)&#10;     */&#10;    public Long getNextAvailableCourier() {&#10;        List&lt;Object&gt; courierQueue = redisTemplate.opsForList().range(COURIER_QUEUE_KEY, 0, -1);&#10;&#10;        if (courierQueue == null || courierQueue.isEmpty()) {&#10;            return null;&#10;        }&#10;&#10;        // Mevcut sıra indeksini al&#10;        Integer currentIndex = (Integer) redisTemplate.opsForValue().get(COURIER_CURRENT_INDEX_KEY);&#10;        if (currentIndex == null) {&#10;            currentIndex = 0;&#10;        }&#10;&#10;        // Sırayı dolaşarak müsait kurye bul&#10;        int startIndex = currentIndex;&#10;        int queueSize = courierQueue.size();&#10;&#10;        for (int i = 0; i &lt; queueSize; i++) {&#10;            int checkIndex = (startIndex + i) % queueSize;&#10;            Long courierId = Long.valueOf(courierQueue.get(checkIndex).toString());&#10;&#10;            if (isCourierAvailable(courierId)) {&#10;                // Sıra indeksini güncelle (bir sonraki kuryeyi işaret etsin)&#10;                int nextIndex = (checkIndex + 1) % queueSize;&#10;                redisTemplate.opsForValue().set(COURIER_CURRENT_INDEX_KEY, nextIndex);&#10;&#10;                return courierId;&#10;            }&#10;        }&#10;&#10;        return null; // Hiç müsait kurye yok&#10;    }&#10;&#10;    /**&#10;     * Kurye müsait mi kontrol eder&#10;     */&#10;    public boolean isCourierAvailable(Long courierId) {&#10;        String status = (String) redisTemplate.opsForValue().get(COURIER_STATUS_KEY + courierId);&#10;        return &quot;AVAILABLE&quot;.equals(status);&#10;    }&#10;&#10;    /**&#10;     * Kurye durumunu günceller&#10;     */&#10;    public void updateCourierStatus(Long courierId, String status) {&#10;        redisTemplate.opsForValue().set(&#10;            COURIER_STATUS_KEY + courierId,&#10;            status,&#10;            java.time.Duration.ofHours(12)&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Kurye lokasyonunu günceller&#10;     */&#10;    public void updateCourierLocation(Long courierId, double latitude, double longitude) {&#10;        String locationData = latitude + &quot;,&quot; + longitude + &quot;,&quot; + LocalDateTime.now();&#10;        redisTemplate.opsForValue().set(&#10;            COURIER_LOCATION_KEY + courierId,&#10;            locationData,&#10;            java.time.Duration.ofHours(2)&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Kurye sırada mı kontrol eder&#10;     */&#10;    public boolean isCourierInQueue(Long courierId) {&#10;        List&lt;Object&gt; courierQueue = redisTemplate.opsForList().range(COURIER_QUEUE_KEY, 0, -1);&#10;        return courierQueue != null &amp;&amp; courierQueue.contains(courierId);&#10;    }&#10;&#10;    /**&#10;     * Aktif kurye sırasını getirir&#10;     */&#10;    public List&lt;Object&gt; getCourierQueue() {&#10;        return redisTemplate.opsForList().range(COURIER_QUEUE_KEY, 0, -1);&#10;    }&#10;&#10;    /**&#10;     * Sırayı temizler (debug/admin için)&#10;     */&#10;    public void clearQueue() {&#10;        redisTemplate.delete(COURIER_QUEUE_KEY);&#10;        redisTemplate.delete(COURIER_CURRENT_INDEX_KEY);&#10;    }&#10;&#10;    /**&#10;     * Sıra istatistiklerini getirir&#10;     */&#10;    public QueueStatistics getQueueStatistics() {&#10;        List&lt;Object&gt; queue = getCourierQueue();&#10;        int totalCouriers = queue != null ? queue.size() : 0;&#10;&#10;        long availableCouriers = 0;&#10;        if (queue != null) {&#10;            availableCouriers = queue.stream()&#10;                .mapToLong(id -&gt; Long.valueOf(id.toString()))&#10;                .mapToInt(id -&gt; isCourierAvailable(id) ? 1 : 0)&#10;                .sum();&#10;        }&#10;&#10;        Integer currentIndex = (Integer) redisTemplate.opsForValue().get(COURIER_CURRENT_INDEX_KEY);&#10;&#10;        return new QueueStatistics(totalCouriers, (int) availableCouriers, currentIndex != null ? currentIndex : 0);&#10;    }&#10;&#10;    // İstatistik sınıfı&#10;    public static class QueueStatistics {&#10;        private int totalCouriers;&#10;        private int availableCouriers;&#10;        private int currentIndex;&#10;&#10;        public QueueStatistics(int totalCouriers, int availableCouriers, int currentIndex) {&#10;            this.totalCouriers = totalCouriers;&#10;            this.availableCouriers = availableCouriers;&#10;            this.currentIndex = currentIndex;&#10;        }&#10;&#10;        // Getters&#10;        public int getTotalCouriers() { return totalCouriers; }&#10;        public int getAvailableCouriers() { return availableCouriers; }&#10;        public int getCurrentIndex() { return currentIndex; }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/service/CourierService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/service/CourierService.java" />
              <option name="originalContent" value="package com.api.demo.service;&#10;&#10;import com.api.demo.dto.CourierDTO;&#10;import com.api.demo.entity.Courier;&#10;import com.api.demo.repository.CourierRepository;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.stereotype.Service;&#10;import java.util.List;&#10;import java.util.Optional;&#10;import java.util.stream.Collectors;&#10;&#10;@Service&#10;public class CourierService {&#10;    &#10;    private final CourierRepository courierRepository;&#10;    &#10;    public CourierService(CourierRepository courierRepository) {&#10;        this.courierRepository = courierRepository;&#10;    }&#10;&#10;    // Get all couriers&#10;    public List&lt;CourierDTO&gt; getAllCouriers() {&#10;        return courierRepository.findAll()&#10;                .stream()&#10;                .map(this::convertToDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    // Get courier by ID&#10;    public Optional&lt;CourierDTO&gt; getCourierById(Long id) {&#10;        return courierRepository.findById(id)&#10;                .map(this::convertToDTO);&#10;    }&#10;&#10;    // Create new courier&#10;    public CourierDTO createCourier(CourierDTO courierDTO) {&#10;        Courier courier = convertToEntity(courierDTO);&#10;        Courier savedCourier = courierRepository.save(courier);&#10;        return convertToDTO(savedCourier);&#10;    }&#10;&#10;    // Update courier&#10;    public Optional&lt;CourierDTO&gt; updateCourier(Long id, CourierDTO courierDTO) {&#10;        return courierRepository.findById(id)&#10;                .map(existingCourier -&gt; {&#10;                    existingCourier.setName(courierDTO.getName());&#10;                    existingCourier.setEmail(courierDTO.getEmail());&#10;                    existingCourier.setPhone(courierDTO.getPhone());&#10;                    existingCourier.setIsAvailable(courierDTO.getIsAvailable());&#10;                    return convertToDTO(courierRepository.save(existingCourier));&#10;                });&#10;    }&#10;&#10;    // Delete courier&#10;    public boolean deleteCourier(Long id) {&#10;        if (courierRepository.existsById(id)) {&#10;            courierRepository.deleteById(id);&#10;            return true;&#10;        }&#10;        return false;&#10;    }&#10;&#10;    // Get available couriers&#10;    public List&lt;CourierDTO&gt; getAvailableCouriers() {&#10;        return courierRepository.findByIsAvailable(true)&#10;                .stream()&#10;                .map(this::convertToDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    // Search couriers by name&#10;    public List&lt;CourierDTO&gt; searchCouriersByName(String name) {&#10;        return courierRepository.findByNameContaining(name)&#10;                .stream()&#10;                .map(this::convertToDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    // Count available couriers&#10;    public Long countAvailableCouriers() {&#10;        return courierRepository.countAvailableCouriers();&#10;    }&#10;&#10;    // Convert Entity to DTO&#10;    private CourierDTO convertToDTO(Courier courier) {&#10;        CourierDTO dto = new CourierDTO();&#10;        dto.setId(courier.getId());&#10;        dto.setName(courier.getName());&#10;        dto.setEmail(courier.getEmail());&#10;        dto.setPhone(courier.getPhone());&#10;        dto.setIsAvailable(courier.getIsAvailable());&#10;        return dto;&#10;    }&#10;&#10;    // Convert DTO to Entity&#10;    private Courier convertToEntity(CourierDTO dto) {&#10;        Courier courier = new Courier();&#10;        courier.setName(dto.getName());&#10;        courier.setEmail(dto.getEmail());&#10;        courier.setPhone(dto.getPhone());&#10;        courier.setIsAvailable(dto.getIsAvailable() != null ? dto.getIsAvailable() : true);&#10;        return courier;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.api.demo.service;&#10;&#10;import com.api.demo.dto.CourierDTO;&#10;import com.api.demo.entity.Courier;&#10;import com.api.demo.repository.CourierRepository;&#10;import org.springframework.stereotype.Service;&#10;import java.util.List;&#10;import java.util.Optional;&#10;import java.util.stream.Collectors;&#10;&#10;@Service&#10;public class CourierService {&#10;    &#10;    private final CourierRepository courierRepository;&#10;    &#10;    public CourierService(CourierRepository courierRepository) {&#10;        this.courierRepository = courierRepository;&#10;    }&#10;&#10;    // Get all couriers&#10;    public List&lt;CourierDTO&gt; getAllCouriers() {&#10;        return courierRepository.findAll()&#10;                .stream()&#10;                .map(this::convertToDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    // Get courier by ID&#10;    public Optional&lt;CourierDTO&gt; getCourierById(Long id) {&#10;        return courierRepository.findById(id)&#10;                .map(this::convertToDTO);&#10;    }&#10;&#10;    // Create new courier&#10;    public CourierDTO createCourier(CourierDTO courierDTO) {&#10;        Courier courier = convertToEntity(courierDTO);&#10;        Courier savedCourier = courierRepository.save(courier);&#10;        return convertToDTO(savedCourier);&#10;    }&#10;&#10;    // Update courier&#10;    public Optional&lt;CourierDTO&gt; updateCourier(Long id, CourierDTO courierDTO) {&#10;        return courierRepository.findById(id)&#10;                .map(existingCourier -&gt; {&#10;                    existingCourier.setName(courierDTO.getName());&#10;                    existingCourier.setEmail(courierDTO.getEmail());&#10;                    existingCourier.setPhone(courierDTO.getPhone());&#10;                    existingCourier.setIsAvailable(courierDTO.getIsAvailable());&#10;                    return convertToDTO(courierRepository.save(existingCourier));&#10;                });&#10;    }&#10;&#10;    // Delete courier&#10;    public boolean deleteCourier(Long id) {&#10;        if (courierRepository.existsById(id)) {&#10;            courierRepository.deleteById(id);&#10;            return true;&#10;        }&#10;        return false;&#10;    }&#10;&#10;    // Get available couriers&#10;    public List&lt;CourierDTO&gt; getAvailableCouriers() {&#10;        return courierRepository.findByIsAvailable(true)&#10;                .stream()&#10;                .map(this::convertToDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    // Search couriers by name&#10;    public List&lt;CourierDTO&gt; searchCouriersByName(String name) {&#10;        return courierRepository.findByNameContaining(name)&#10;                .stream()&#10;                .map(this::convertToDTO)&#10;                .collect(Collectors.toList());&#10;    }&#10;&#10;    // Count available couriers&#10;    public Long countAvailableCouriers() {&#10;        return courierRepository.countAvailableCouriers();&#10;    }&#10;&#10;    // Convert Entity to DTO&#10;    private CourierDTO convertToDTO(Courier courier) {&#10;        CourierDTO dto = new CourierDTO();&#10;        dto.setId(courier.getId());&#10;        dto.setName(courier.getName());&#10;        dto.setEmail(courier.getEmail());&#10;        dto.setPhone(courier.getPhone());&#10;        dto.setIsAvailable(courier.getIsAvailable());&#10;        return dto;&#10;    }&#10;&#10;    // Convert DTO to Entity&#10;    private Courier convertToEntity(CourierDTO dto) {&#10;        Courier courier = new Courier();&#10;        courier.setName(dto.getName());&#10;        courier.setEmail(dto.getEmail());&#10;        courier.setPhone(dto.getPhone());&#10;        courier.setIsAvailable(dto.getIsAvailable() != null ? dto.getIsAvailable() : true);&#10;        return courier;&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/com/api/demo/service/OrderAssignmentService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/api/demo/service/OrderAssignmentService.java" />
              <option name="originalContent" value="package com.api.demo.service;&#10;&#10;import com.api.demo.entity.Business;&#10;import com.api.demo.entity.Courier;&#10;import com.api.demo.entity.Order;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.data.redis.core.RedisTemplate;&#10;import org.springframework.kafka.core.KafkaTemplate;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDateTime;&#10;import java.util.*;&#10;import java.util.stream.Collectors;&#10;&#10;@Service&#10;public class OrderAssignmentService {&#10;&#10;    @Autowired&#10;    private RedisTemplate&lt;String, Object&gt; redisTemplate;&#10;&#10;    @Autowired&#10;    private KafkaTemplate&lt;String, Object&gt; kafkaTemplate;&#10;&#10;    @Autowired&#10;    private CourierQueueService courierQueueService;&#10;&#10;    @Autowired&#10;    private CourierService courierService;&#10;&#10;    private static final String PENDING_ORDERS_KEY = &quot;orders:pending&quot;;&#10;    private static final String COURIER_ORDERS_KEY = &quot;courier:orders:&quot;;&#10;    private static final String BUSINESS_ORDERS_KEY = &quot;business:orders:&quot;;&#10;    private static final double MAX_DISTANCE_KM = 10.0; // Maksimum atama mesafesi&#10;&#10;    /**&#10;     * Yeni sipariş geldiğinde otomatik atama yapar&#10;     */&#10;    public AssignmentResult assignOrderToCourier(Order order) {&#10;        // Pending orders cache'e ekle&#10;        addOrderToPendingQueue(order);&#10;&#10;        // En uygun kuryeyi bul&#10;        CourierMatch bestMatch = findOptimalCourier(order);&#10;&#10;        if (bestMatch != null) {&#10;            // Kuryeye ata&#10;            assignOrderDirectly(order.getId(), bestMatch.getCourierId());&#10;&#10;            // Kafka'ya bildirim gönder&#10;            sendOrderAssignmentNotification(order, bestMatch.getCourierId());&#10;&#10;            return new AssignmentResult(true, bestMatch.getCourierId(), &quot;Order successfully assigned&quot;);&#10;        } else {&#10;            // Müsait kurye yok, beklemede kalacak&#10;            return new AssignmentResult(false, null, &quot;No available courier found, order queued&quot;);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * En uygun kuryeyi bulur (mesafe + sıra + mevcut yük)&#10;     */&#10;    private CourierMatch findOptimalCourier(Order order) {&#10;        List&lt;Object&gt; courierQueue = courierQueueService.getCourierQueue();&#10;        if (courierQueue == null || courierQueue.isEmpty()) {&#10;            return null;&#10;        }&#10;&#10;        List&lt;CourierMatch&gt; candidates = new ArrayList&lt;&gt;();&#10;&#10;        for (Object courierIdObj : courierQueue) {&#10;            Long courierId = Long.valueOf(courierIdObj.toString());&#10;&#10;            if (!courierQueueService.isCourierAvailable(courierId)) {&#10;                continue;&#10;            }&#10;&#10;            Optional&lt;Courier&gt; courierOpt = courierService.getCourierById(courierId)&#10;                .map(dto -&gt; convertDTOToEntity(dto));&#10;&#10;            if (courierOpt.isEmpty()) {&#10;                continue;&#10;            }&#10;&#10;            Courier courier = courierOpt.get();&#10;&#10;            // Mesafe hesapla&#10;            double distance = calculateDistance(&#10;                order.getPickupLatitude(), order.getPickupLongitude(),&#10;                courier.getCurrentLatitude(), courier.getCurrentLongitude()&#10;            );&#10;&#10;            if (distance &lt;= MAX_DISTANCE_KM) {&#10;                // Kurye yükünü kontrol et&#10;                int currentLoad = getCourierCurrentLoad(courierId);&#10;                int maxLoad = getMaxLoadForVehicle(courier.getVehicleType());&#10;&#10;                if (currentLoad &lt; maxLoad) {&#10;                    candidates.add(new CourierMatch(&#10;                        courierId,&#10;                        distance,&#10;                        currentLoad,&#10;                        maxLoad,&#10;                        getCourierPriority(courierId)&#10;                    ));&#10;                }&#10;            }&#10;        }&#10;&#10;        // En uygun kuryeyi seç (mesafe + yük + sıra önceliği)&#10;        return candidates.stream()&#10;            .min(Comparator&#10;                .comparingDouble(CourierMatch::getDistance)&#10;                .thenComparingInt(CourierMatch::getCurrentLoad)&#10;                .thenComparingInt(CourierMatch::getPriority))&#10;            .orElse(null);&#10;    }&#10;&#10;    /**&#10;     * Siparişi doğrudan kuryeye atar&#10;     */&#10;    public void assignOrderDirectly(Long orderId, Long courierId) {&#10;        // Redis'te atamayı kaydet&#10;        redisTemplate.opsForSet().add(COURIER_ORDERS_KEY + courierId, orderId);&#10;&#10;        // Kurye durumunu güncelle&#10;        courierQueueService.updateCourierStatus(courierId, &quot;BUSY&quot;);&#10;&#10;        // Pending orders'dan çıkar&#10;        redisTemplate.opsForSet().remove(PENDING_ORDERS_KEY, orderId);&#10;&#10;        // Cache'e atama bilgisini kaydet&#10;        Map&lt;String, Object&gt; assignmentData = new HashMap&lt;&gt;();&#10;        assignmentData.put(&quot;orderId&quot;, orderId);&#10;        assignmentData.put(&quot;courierId&quot;, courierId);&#10;        assignmentData.put(&quot;assignedAt&quot;, LocalDateTime.now().toString());&#10;&#10;        redisTemplate.opsForValue().set(&#10;            &quot;assignment:&quot; + orderId,&#10;            assignmentData,&#10;            java.time.Duration.ofHours(24)&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Kurye müsait olduğunda bekleyen siparişleri kontrol eder&#10;     */&#10;    public void processPendingOrdersForAvailableCourier(Long courierId) {&#10;        Set&lt;Object&gt; pendingOrders = redisTemplate.opsForSet().members(PENDING_ORDERS_KEY);&#10;&#10;        if (pendingOrders == null || pendingOrders.isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        // En uygun bekleyen siparişi bul&#10;        for (Object orderIdObj : pendingOrders) {&#10;            Long orderId = Long.valueOf(orderIdObj.toString());&#10;&#10;            // Order bilgilerini cache'den al (veya DB'den)&#10;            Order order = getOrderFromCache(orderId);&#10;            if (order != null) {&#10;                CourierMatch match = evaluateCourierForOrder(courierId, order);&#10;                if (match != null) {&#10;                    assignOrderDirectly(orderId, courierId);&#10;                    sendOrderAssignmentNotification(order, courierId);&#10;                    break; // Bir sipariş atandı, döngüden çık&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Toplu optimizasyon - çok sipariş varsa optimize eder&#10;     */&#10;    public void optimizeBulkAssignments() {&#10;        Set&lt;Object&gt; pendingOrders = redisTemplate.opsForSet().members(PENDING_ORDERS_KEY);&#10;        List&lt;Object&gt; availableCouriers = courierQueueService.getCourierQueue().stream()&#10;            .filter(courierId -&gt; courierQueueService.isCourierAvailable(Long.valueOf(courierId.toString())))&#10;            .collect(Collectors.toList());&#10;&#10;        if (pendingOrders == null || pendingOrders.size() &lt; 5 || availableCouriers.size() &lt; 2) {&#10;            return; // Optimizasyon gerekmez&#10;        }&#10;&#10;        // Kafka'ya toplu optimizasyon mesajı gönder&#10;        Map&lt;String, Object&gt; optimizationRequest = new HashMap&lt;&gt;();&#10;        optimizationRequest.put(&quot;pendingOrders&quot;, pendingOrders.size());&#10;        optimizationRequest.put(&quot;availableCouriers&quot;, availableCouriers.size());&#10;        optimizationRequest.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;bulk-optimization&quot;, optimizationRequest);&#10;    }&#10;&#10;    /**&#10;     * Kafka notification gönderir&#10;     */&#10;    private void sendOrderAssignmentNotification(Order order, Long courierId) {&#10;        Map&lt;String, Object&gt; notification = new HashMap&lt;&gt;();&#10;        notification.put(&quot;type&quot;, &quot;ORDER_ASSIGNED&quot;);&#10;        notification.put(&quot;orderId&quot;, order.getId());&#10;        notification.put(&quot;orderNumber&quot;, order.getOrderNumber());&#10;        notification.put(&quot;courierId&quot;, courierId);&#10;        notification.put(&quot;businessId&quot;, order.getBusiness().getId());&#10;        notification.put(&quot;priority&quot;, order.getPriority().toString());&#10;        notification.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        // Farklı topic'lere gönder&#10;        kafkaTemplate.send(&quot;order-assignments&quot;, notification);&#10;        kafkaTemplate.send(&quot;courier-notifications&quot;, notification);&#10;    }&#10;&#10;    // Yardımcı metodlar&#10;    private void addOrderToPendingQueue(Order order) {&#10;        redisTemplate.opsForSet().add(PENDING_ORDERS_KEY, order.getId());&#10;&#10;        // Order cache'e kaydet&#10;        Map&lt;String, Object&gt; orderData = new HashMap&lt;&gt;();&#10;        orderData.put(&quot;id&quot;, order.getId());&#10;        orderData.put(&quot;businessId&quot;, order.getBusiness().getId());&#10;        orderData.put(&quot;pickupLat&quot;, order.getPickupLatitude());&#10;        orderData.put(&quot;pickupLng&quot;, order.getPickupLongitude());&#10;        orderData.put(&quot;priority&quot;, order.getPriority().toString());&#10;&#10;        redisTemplate.opsForValue().set(&#10;            &quot;order:cache:&quot; + order.getId(),&#10;            orderData,&#10;            java.time.Duration.ofHours(6)&#10;        );&#10;    }&#10;&#10;    private double calculateDistance(Double lat1, Double lon1, Double lat2, Double lon2) {&#10;        if (lat1 == null || lon1 == null || lat2 == null || lon2 == null) {&#10;            return Double.MAX_VALUE;&#10;        }&#10;&#10;        // Haversine formula&#10;        double R = 6371; // Earth radius in kilometers&#10;        double dLat = Math.toRadians(lat2 - lat1);&#10;        double dLon = Math.toRadians(lon2 - lon1);&#10;        double a = Math.sin(dLat/2) * Math.sin(dLat/2) +&#10;                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *&#10;                Math.sin(dLon/2) * Math.sin(dLon/2);&#10;        double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));&#10;        return R * c;&#10;    }&#10;&#10;    private int getCourierCurrentLoad(Long courierId) {&#10;        Set&lt;Object&gt; orders = redisTemplate.opsForSet().members(COURIER_ORDERS_KEY + courierId);&#10;        return orders != null ? orders.size() : 0;&#10;    }&#10;&#10;    private int getMaxLoadForVehicle(Courier.VehicleType vehicleType) {&#10;        return switch (vehicleType) {&#10;            case WALKING, BICYCLE -&gt; 2;&#10;            case MOTORCYCLE -&gt; 4;&#10;            case CAR -&gt; 6;&#10;            case VAN -&gt; 10;&#10;            case TRUCK -&gt; 15;&#10;            default -&gt; 3;&#10;        };&#10;    }&#10;&#10;    private int getCourierPriority(Long courierId) {&#10;        // Sıradaki pozisyonu döndür (düşük sayı = yüksek öncelik)&#10;        List&lt;Object&gt; queue = courierQueueService.getCourierQueue();&#10;        return queue.indexOf(courierId);&#10;    }&#10;&#10;    private CourierMatch evaluateCourierForOrder(Long courierId, Order order) {&#10;        // Kurye için order uygunluğunu değerlendir&#10;        // Basitleştirilmiş versiyon&#10;        return new CourierMatch(courierId, 1.0, 0, 5, 0);&#10;    }&#10;&#10;    private Order getOrderFromCache(Long orderId) {&#10;        // Cache'den order bilgilerini al&#10;        // Implementasyon basitleştirildi&#10;        return null;&#10;    }&#10;&#10;    private Courier convertDTOToEntity(com.api.demo.dto.CourierDTO dto) {&#10;        // DTO'dan Entity'ye çevir&#10;        // Implementasyon basitleştirildi&#10;        return new Courier();&#10;    }&#10;&#10;    // Inner classes&#10;    public static class AssignmentResult {&#10;        private boolean success;&#10;        private Long courierId;&#10;        private String message;&#10;&#10;        public AssignmentResult(boolean success, Long courierId, String message) {&#10;            this.success = success;&#10;            this.courierId = courierId;&#10;            this.message = message;&#10;        }&#10;&#10;        // Getters&#10;        public boolean isSuccess() { return success; }&#10;        public Long getCourierId() { return courierId; }&#10;        public String getMessage() { return message; }&#10;    }&#10;&#10;    public static class CourierMatch {&#10;        private Long courierId;&#10;        private double distance;&#10;        private int currentLoad;&#10;        private int maxLoad;&#10;        private int priority;&#10;&#10;        public CourierMatch(Long courierId, double distance, int currentLoad, int maxLoad, int priority) {&#10;            this.courierId = courierId;&#10;            this.distance = distance;&#10;            this.currentLoad = currentLoad;&#10;            this.maxLoad = maxLoad;&#10;            this.priority = priority;&#10;        }&#10;&#10;        // Getters&#10;        public Long getCourierId() { return courierId; }&#10;        public double getDistance() { return distance; }&#10;        public int getCurrentLoad() { return currentLoad; }&#10;        public int getMaxLoad() { return maxLoad; }&#10;        public int getPriority() { return priority; }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.api.demo.service;&#10;&#10;import com.api.demo.entity.Business;&#10;import com.api.demo.entity.Courier;&#10;import com.api.demo.entity.Order;&#10;import org.springframework.data.redis.core.RedisTemplate;&#10;import org.springframework.kafka.core.KafkaTemplate;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.time.LocalDateTime;&#10;import java.util.*;&#10;import java.util.stream.Collectors;&#10;&#10;@Service&#10;public class OrderAssignmentService {&#10;&#10;    private final RedisTemplate&lt;String, Object&gt; redisTemplate;&#10;    private final KafkaTemplate&lt;String, Object&gt; kafkaTemplate;&#10;    private final CourierQueueService courierQueueService;&#10;    private final CourierService courierService;&#10;&#10;    public OrderAssignmentService(&#10;            RedisTemplate&lt;String, Object&gt; redisTemplate,&#10;            KafkaTemplate&lt;String, Object&gt; kafkaTemplate,&#10;            CourierQueueService courierQueueService,&#10;            CourierService courierService) {&#10;        this.redisTemplate = redisTemplate;&#10;        this.kafkaTemplate = kafkaTemplate;&#10;        this.courierQueueService = courierQueueService;&#10;        this.courierService = courierService;&#10;    }&#10;&#10;    private static final String PENDING_ORDERS_KEY = &quot;orders:pending&quot;;&#10;    private static final String COURIER_ORDERS_KEY = &quot;courier:orders:&quot;;&#10;    private static final String BUSINESS_ORDERS_KEY = &quot;business:orders:&quot;;&#10;    private static final double MAX_DISTANCE_KM = 10.0; // Maksimum atama mesafesi&#10;&#10;    /**&#10;     * Yeni sipariş geldiğinde otomatik atama yapar&#10;     */&#10;    public AssignmentResult assignOrderToCourier(Order order) {&#10;        // Pending orders cache'e ekle&#10;        addOrderToPendingQueue(order);&#10;&#10;        // En uygun kuryeyi bul&#10;        CourierMatch bestMatch = findOptimalCourier(order);&#10;&#10;        if (bestMatch != null) {&#10;            // Kuryeye ata&#10;            assignOrderDirectly(order.getId(), bestMatch.getCourierId());&#10;&#10;            // Kafka'ya bildirim gönder&#10;            sendOrderAssignmentNotification(order, bestMatch.getCourierId());&#10;&#10;            return new AssignmentResult(true, bestMatch.getCourierId(), &quot;Order successfully assigned&quot;);&#10;        } else {&#10;            // Müsait kurye yok, beklemede kalacak&#10;            return new AssignmentResult(false, null, &quot;No available courier found, order queued&quot;);&#10;        }&#10;    }&#10;&#10;    /**&#10;     * En uygun kuryeyi bulur (mesafe + sıra + mevcut yük)&#10;     */&#10;    private CourierMatch findOptimalCourier(Order order) {&#10;        List&lt;Object&gt; courierQueue = courierQueueService.getCourierQueue();&#10;        if (courierQueue == null || courierQueue.isEmpty()) {&#10;            return null;&#10;        }&#10;&#10;        List&lt;CourierMatch&gt; candidates = new ArrayList&lt;&gt;();&#10;&#10;        for (Object courierIdObj : courierQueue) {&#10;            Long courierId = Long.valueOf(courierIdObj.toString());&#10;&#10;            if (!courierQueueService.isCourierAvailable(courierId)) {&#10;                continue;&#10;            }&#10;&#10;            Optional&lt;Courier&gt; courierOpt = courierService.getCourierById(courierId)&#10;                .map(dto -&gt; convertDTOToEntity(dto));&#10;&#10;            if (courierOpt.isEmpty()) {&#10;                continue;&#10;            }&#10;&#10;            Courier courier = courierOpt.get();&#10;&#10;            // Mesafe hesapla&#10;            double distance = calculateDistance(&#10;                order.getPickupLatitude(), order.getPickupLongitude(),&#10;                courier.getCurrentLatitude(), courier.getCurrentLongitude()&#10;            );&#10;&#10;            if (distance &lt;= MAX_DISTANCE_KM) {&#10;                // Kurye yükünü kontrol et&#10;                int currentLoad = getCourierCurrentLoad(courierId);&#10;                int maxLoad = getMaxLoadForVehicle(courier.getVehicleType());&#10;&#10;                if (currentLoad &lt; maxLoad) {&#10;                    candidates.add(new CourierMatch(&#10;                        courierId,&#10;                        distance,&#10;                        currentLoad,&#10;                        maxLoad,&#10;                        getCourierPriority(courierId)&#10;                    ));&#10;                }&#10;            }&#10;        }&#10;&#10;        // En uygun kuryeyi seç (mesafe + yük + sıra önceliği)&#10;        return candidates.stream()&#10;            .min(Comparator&#10;                .comparingDouble(CourierMatch::getDistance)&#10;                .thenComparingInt(CourierMatch::getCurrentLoad)&#10;                .thenComparingInt(CourierMatch::getPriority))&#10;            .orElse(null);&#10;    }&#10;&#10;    /**&#10;     * Siparişi doğrudan kuryeye atar&#10;     */&#10;    public void assignOrderDirectly(Long orderId, Long courierId) {&#10;        // Redis'te atamayı kaydet&#10;        redisTemplate.opsForSet().add(COURIER_ORDERS_KEY + courierId, orderId);&#10;&#10;        // Kurye durumunu güncelle&#10;        courierQueueService.updateCourierStatus(courierId, &quot;BUSY&quot;);&#10;&#10;        // Pending orders'dan çıkar&#10;        redisTemplate.opsForSet().remove(PENDING_ORDERS_KEY, orderId);&#10;&#10;        // Cache'e atama bilgisini kaydet&#10;        Map&lt;String, Object&gt; assignmentData = new HashMap&lt;&gt;();&#10;        assignmentData.put(&quot;orderId&quot;, orderId);&#10;        assignmentData.put(&quot;courierId&quot;, courierId);&#10;        assignmentData.put(&quot;assignedAt&quot;, LocalDateTime.now().toString());&#10;&#10;        redisTemplate.opsForValue().set(&#10;            &quot;assignment:&quot; + orderId,&#10;            assignmentData,&#10;            java.time.Duration.ofHours(24)&#10;        );&#10;    }&#10;&#10;    /**&#10;     * Kurye müsait olduğunda bekleyen siparişleri kontrol eder&#10;     */&#10;    public void processPendingOrdersForAvailableCourier(Long courierId) {&#10;        Set&lt;Object&gt; pendingOrders = redisTemplate.opsForSet().members(PENDING_ORDERS_KEY);&#10;&#10;        if (pendingOrders == null || pendingOrders.isEmpty()) {&#10;            return;&#10;        }&#10;&#10;        // En uygun bekleyen siparişi bul&#10;        for (Object orderIdObj : pendingOrders) {&#10;            Long orderId = Long.valueOf(orderIdObj.toString());&#10;&#10;            // Order bilgilerini cache'den al (veya DB'den)&#10;            Order order = getOrderFromCache(orderId);&#10;            if (order != null) {&#10;                CourierMatch match = evaluateCourierForOrder(courierId, order);&#10;                if (match != null) {&#10;                    assignOrderDirectly(orderId, courierId);&#10;                    sendOrderAssignmentNotification(order, courierId);&#10;                    break; // Bir sipariş atandı, döngüden çık&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Toplu optimizasyon - çok sipariş varsa optimize eder&#10;     */&#10;    public void optimizeBulkAssignments() {&#10;        Set&lt;Object&gt; pendingOrders = redisTemplate.opsForSet().members(PENDING_ORDERS_KEY);&#10;        List&lt;Object&gt; availableCouriers = courierQueueService.getCourierQueue().stream()&#10;            .filter(courierId -&gt; courierQueueService.isCourierAvailable(Long.valueOf(courierId.toString())))&#10;            .collect(Collectors.toList());&#10;&#10;        if (pendingOrders == null || pendingOrders.size() &lt; 5 || availableCouriers.size() &lt; 2) {&#10;            return; // Optimizasyon gerekmez&#10;        }&#10;&#10;        // Kafka'ya toplu optimizasyon mesajı gönder&#10;        Map&lt;String, Object&gt; optimizationRequest = new HashMap&lt;&gt;();&#10;        optimizationRequest.put(&quot;pendingOrders&quot;, pendingOrders.size());&#10;        optimizationRequest.put(&quot;availableCouriers&quot;, availableCouriers.size());&#10;        optimizationRequest.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        kafkaTemplate.send(&quot;bulk-optimization&quot;, optimizationRequest);&#10;    }&#10;&#10;    /**&#10;     * Kafka notification gönderir&#10;     */&#10;    private void sendOrderAssignmentNotification(Order order, Long courierId) {&#10;        Map&lt;String, Object&gt; notification = new HashMap&lt;&gt;();&#10;        notification.put(&quot;type&quot;, &quot;ORDER_ASSIGNED&quot;);&#10;        notification.put(&quot;orderId&quot;, order.getId());&#10;        notification.put(&quot;orderNumber&quot;, order.getOrderNumber());&#10;        notification.put(&quot;courierId&quot;, courierId);&#10;        notification.put(&quot;businessId&quot;, order.getBusiness().getId());&#10;        notification.put(&quot;priority&quot;, order.getPriority().toString());&#10;        notification.put(&quot;timestamp&quot;, LocalDateTime.now().toString());&#10;&#10;        // Farklı topic'lere gönder&#10;        kafkaTemplate.send(&quot;order-assignments&quot;, notification);&#10;        kafkaTemplate.send(&quot;courier-notifications&quot;, notification);&#10;    }&#10;&#10;    // Yardımcı metodlar&#10;    private void addOrderToPendingQueue(Order order) {&#10;        redisTemplate.opsForSet().add(PENDING_ORDERS_KEY, order.getId());&#10;&#10;        // Order cache'e kaydet&#10;        Map&lt;String, Object&gt; orderData = new HashMap&lt;&gt;();&#10;        orderData.put(&quot;id&quot;, order.getId());&#10;        orderData.put(&quot;businessId&quot;, order.getBusiness().getId());&#10;        orderData.put(&quot;pickupLat&quot;, order.getPickupLatitude());&#10;        orderData.put(&quot;pickupLng&quot;, order.getPickupLongitude());&#10;        orderData.put(&quot;priority&quot;, order.getPriority().toString());&#10;&#10;        redisTemplate.opsForValue().set(&#10;            &quot;order:cache:&quot; + order.getId(),&#10;            orderData,&#10;            java.time.Duration.ofHours(6)&#10;        );&#10;    }&#10;&#10;    private double calculateDistance(Double lat1, Double lon1, Double lat2, Double lon2) {&#10;        if (lat1 == null || lon1 == null || lat2 == null || lon2 == null) {&#10;            return Double.MAX_VALUE;&#10;        }&#10;&#10;        // Haversine formula&#10;        double R = 6371; // Earth radius in kilometers&#10;        double dLat = Math.toRadians(lat2 - lat1);&#10;        double dLon = Math.toRadians(lon2 - lon1);&#10;        double a = Math.sin(dLat/2) * Math.sin(dLat/2) +&#10;                Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2)) *&#10;                Math.sin(dLon/2) * Math.sin(dLon/2);&#10;        double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));&#10;        return R * c;&#10;    }&#10;&#10;    private int getCourierCurrentLoad(Long courierId) {&#10;        Set&lt;Object&gt; orders = redisTemplate.opsForSet().members(COURIER_ORDERS_KEY + courierId);&#10;        return orders != null ? orders.size() : 0;&#10;    }&#10;&#10;    private int getMaxLoadForVehicle(Courier.VehicleType vehicleType) {&#10;        return switch (vehicleType) {&#10;            case WALKING, BICYCLE -&gt; 2;&#10;            case MOTORCYCLE -&gt; 4;&#10;            case CAR -&gt; 6;&#10;            case VAN -&gt; 10;&#10;            case TRUCK -&gt; 15;&#10;            default -&gt; 3;&#10;        };&#10;    }&#10;&#10;    private int getCourierPriority(Long courierId) {&#10;        // Sıradaki pozisyonu döndür (düşük sayı = yüksek öncelik)&#10;        List&lt;Object&gt; queue = courierQueueService.getCourierQueue();&#10;        return queue.indexOf(courierId);&#10;    }&#10;&#10;    private CourierMatch evaluateCourierForOrder(Long courierId, Order order) {&#10;        // Kurye için order uygunluğunu değerlendir&#10;        // Basitleştirilmiş versiyon&#10;        return new CourierMatch(courierId, 1.0, 0, 5, 0);&#10;    }&#10;&#10;    private Order getOrderFromCache(Long orderId) {&#10;        // Cache'den order bilgilerini al&#10;        // Implementasyon basitleştirildi&#10;        return null;&#10;    }&#10;&#10;    private Courier convertDTOToEntity(com.api.demo.dto.CourierDTO dto) {&#10;        // DTO'dan Entity'ye çevir&#10;        // Implementasyon basitleştirildi&#10;        return new Courier();&#10;    }&#10;&#10;    // Inner classes&#10;    public static class AssignmentResult {&#10;        private boolean success;&#10;        private Long courierId;&#10;        private String message;&#10;&#10;        public AssignmentResult(boolean success, Long courierId, String message) {&#10;            this.success = success;&#10;            this.courierId = courierId;&#10;            this.message = message;&#10;        }&#10;&#10;        // Getters&#10;        public boolean isSuccess() { return success; }&#10;        public Long getCourierId() { return courierId; }&#10;        public String getMessage() { return message; }&#10;    }&#10;&#10;    public static class CourierMatch {&#10;        private Long courierId;&#10;        private double distance;&#10;        private int currentLoad;&#10;        private int maxLoad;&#10;        private int priority;&#10;&#10;        public CourierMatch(Long courierId, double distance, int currentLoad, int maxLoad, int priority) {&#10;            this.courierId = courierId;&#10;            this.distance = distance;&#10;            this.currentLoad = currentLoad;&#10;            this.maxLoad = maxLoad;&#10;            this.priority = priority;&#10;        }&#10;&#10;        // Getters&#10;        public Long getCourierId() { return courierId; }&#10;        public double getDistance() { return distance; }&#10;        public int getCurrentLoad() { return currentLoad; }&#10;        public int getMaxLoad() { return maxLoad; }&#10;        public int getPriority() { return priority; }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/application.properties">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/application.properties" />
              <option name="originalContent" value="spring.application.name=i-need-courier&#10;&#10;# Server configuration&#10;server.port=8080&#10;&#10;# Security configuration&#10;spring.security.user.name=admin&#10;spring.security.user.password=admin123&#10;spring.security.user.roles=ADMIN&#10;&#10;# Database configuration&#10;spring.datasource.url=jdbc:mysql://mysql:3306/courier_db?useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=UTC&#10;spring.datasource.username=courier_user&#10;spring.datasource.password=courier_password&#10;spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver&#10;&#10;# JPA configuration&#10;spring.jpa.hibernate.ddl-auto=update&#10;spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect&#10;spring.jpa.show-sql=true&#10;&#10;# Redis configuration&#10;spring.data.redis.host=redis&#10;spring.data.redis.port=6379&#10;spring.session.store-type=redis&#10;&#10;# Kafka configuration&#10;spring.kafka.bootstrap-servers=kafka:9092&#10;spring.kafka.consumer.group-id=courier-service&#10;spring.kafka.consumer.auto-offset-reset=earliest&#10;&#10;# Actuator configuration&#10;management.endpoints.web.exposure.include=health,info,metrics&#10;management.endpoint.health.show-details=always&#10;" />
              <option name="updatedContent" value="spring.application.name=i-need-courier&#10;&#10;# Server configuration&#10;server.port=8080&#10;&#10;# Security configuration&#10;spring.security.user.name=admin&#10;spring.security.user.password=admin123&#10;spring.security.user.roles=ADMIN&#10;&#10;# Database configuration&#10;spring.datasource.url=jdbc:mysql://mysql:3306/courier_db?useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=UTC&#10;spring.datasource.username=courier_user&#10;spring.datasource.password=courier_password&#10;spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver&#10;&#10;# JPA configuration&#10;spring.jpa.hibernate.ddl-auto=validate&#10;spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect&#10;spring.jpa.show-sql=true&#10;&#10;# Flyway configuration&#10;spring.flyway.enabled=true&#10;spring.flyway.locations=classpath:db/migration&#10;spring.flyway.baseline-on-migrate=true&#10;spring.flyway.validate-on-migrate=true&#10;&#10;# Redis configuration&#10;spring.data.redis.host=redis&#10;spring.data.redis.port=6379&#10;spring.session.store-type=redis&#10;&#10;# Kafka configuration&#10;spring.kafka.bootstrap-servers=kafka:9092&#10;spring.kafka.consumer.group-id=courier-service&#10;spring.kafka.consumer.auto-offset-reset=earliest&#10;&#10;# Actuator configuration&#10;management.endpoints.web.exposure.include=health,info,metrics&#10;management.endpoint.health.show-details=always" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/db/migration/V1__Create_initial_tables.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/db/migration/V1__Create_initial_tables.sql" />
              <option name="originalContent" value="&#10;&#10;" />
              <option name="updatedContent" value="-- V1__Create_initial_tables.sql&#10;-- B2B Kurye servisi için temel tabloları oluşturan migration&#10;&#10;-- System Users tablosu (Sadece sistem kullanıcıları: Admin, Koordinatör, Kurye)&#10;CREATE TABLE system_users (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    username VARCHAR(50) UNIQUE NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    password VARCHAR(255) NOT NULL,&#10;    first_name VARCHAR(50),&#10;    last_name VARCHAR(50),&#10;    phone VARCHAR(20),&#10;    role ENUM('ADMIN', 'COORDINATOR', 'COURIER') NOT NULL,&#10;    is_active BOOLEAN DEFAULT TRUE,&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;&#10;    INDEX idx_email (email),&#10;    INDEX idx_username (username),&#10;    INDEX idx_role (role),&#10;    INDEX idx_is_active (is_active)&#10;);&#10;&#10;-- Vehicles tablosu (Araç bilgileri)&#10;CREATE TABLE vehicles (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    plate_number VARCHAR(20) UNIQUE NOT NULL,&#10;    vehicle_type ENUM('BICYCLE', 'MOTORCYCLE', 'CAR', 'VAN', 'TRUCK', 'WALKING') NOT NULL,&#10;    brand VARCHAR(50),&#10;    model VARCHAR(50),&#10;    year INT,&#10;    color VARCHAR(30),&#10;    max_weight_capacity DECIMAL(8,2) COMMENT 'Maksimum taşıma kapasitesi (kg)',&#10;    is_active BOOLEAN DEFAULT TRUE,&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;&#10;    INDEX idx_plate_number (plate_number),&#10;    INDEX idx_vehicle_type (vehicle_type),&#10;    INDEX idx_is_active (is_active)&#10;);&#10;&#10;-- Coordinators tablosu (Takım kaptanları/koordinatörler)&#10;CREATE TABLE coordinators (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    system_user_id BIGINT UNIQUE,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20) NOT NULL,&#10;    employee_id VARCHAR(50) UNIQUE,&#10;    work_type ENUM('JOKER', 'SHIFT') DEFAULT 'SHIFT',&#10;    shift_start TIME,&#10;    shift_end TIME,&#10;    is_active BOOLEAN DEFAULT TRUE,&#10;    status ENUM('ONLINE', 'OFFLINE', 'BUSY', 'ON_BREAK', 'IN_FIELD') DEFAULT 'OFFLINE',&#10;    current_latitude DECIMAL(10, 8),&#10;    current_longitude DECIMAL(11, 8),&#10;    coverage_area VARCHAR(500) COMMENT 'Sorumlu olduğu bölge',&#10;    max_courier_count INT DEFAULT 10 COMMENT 'Maksimum yönetebileceği kurye sayısı',&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;&#10;    FOREIGN KEY (system_user_id) REFERENCES system_users(id) ON DELETE SET NULL,&#10;    INDEX idx_email (email),&#10;    INDEX idx_employee_id (employee_id),&#10;    INDEX idx_status (status),&#10;    INDEX idx_is_active (is_active),&#10;    INDEX idx_location (current_latitude, current_longitude)&#10;);&#10;&#10;-- Couriers tablosu (Kuryeler)&#10;CREATE TABLE couriers (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    system_user_id BIGINT UNIQUE,&#10;    name VARCHAR(100) NOT NULL,&#10;    email VARCHAR(100) UNIQUE NOT NULL,&#10;    phone VARCHAR(20) NOT NULL,&#10;    license_number VARCHAR(50),&#10;    vehicle_type ENUM('BICYCLE', 'MOTORCYCLE', 'CAR', 'VAN', 'TRUCK', 'WALKING'),&#10;    work_type ENUM('JOKER', 'SHIFT') DEFAULT 'SHIFT',&#10;    shift_start TIME,&#10;    shift_end TIME,&#10;    is_available BOOLEAN DEFAULT TRUE,&#10;    status ENUM('ONLINE', 'OFFLINE', 'BUSY', 'ON_BREAK', 'IN_DELIVERY') DEFAULT 'OFFLINE',&#10;    current_latitude DECIMAL(10, 8),&#10;    current_longitude DECIMAL(11, 8),&#10;    current_location_name VARCHAR(200),&#10;    total_deliveries INT DEFAULT 0,&#10;    vehicle_id BIGINT,&#10;    coordinator_id BIGINT,&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;&#10;    FOREIGN KEY (system_user_id) REFERENCES system_users(id) ON DELETE SET NULL,&#10;    FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE SET NULL,&#10;    FOREIGN KEY (coordinator_id) REFERENCES coordinators(id) ON DELETE SET NULL,&#10;    INDEX idx_email (email),&#10;    INDEX idx_status (status),&#10;    INDEX idx_is_available (is_available),&#10;    INDEX idx_work_type (work_type),&#10;    INDEX idx_vehicle_type (vehicle_type),&#10;    INDEX idx_location (current_latitude, current_longitude),&#10;    INDEX idx_coordinator_id (coordinator_id)&#10;);&#10;&#10;-- Business/Company tablosu (İşletmeler - sipariş veren firmalar)&#10;CREATE TABLE businesses (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    business_code VARCHAR(50) UNIQUE NOT NULL COMMENT 'İşletme kodu (otomatik veya manuel)',&#10;    name VARCHAR(200) NOT NULL,&#10;    contact_person VARCHAR(100) COMMENT 'İrtibat kişisi',&#10;    phone VARCHAR(20) NOT NULL,&#10;    email VARCHAR(100),&#10;    address VARCHAR(500) NOT NULL,&#10;    address_description TEXT COMMENT 'Adres tarifi - detaylı açıklama',&#10;    latitude DECIMAL(10, 8),&#10;    longitude DECIMAL(11, 8),&#10;    location_name VARCHAR(200) COMMENT 'Konum ismi (Kadıköy, Merkez vb.)',&#10;    business_type VARCHAR(100) COMMENT 'İşletme türü (Restaurant, Market, Eczane vb.)',&#10;    payment_terms ENUM('PREPAID', 'POSTPAID', 'CASH_ON_DELIVERY') DEFAULT 'POSTPAID',&#10;    credit_limit DECIMAL(10,2) DEFAULT 0.00,&#10;    is_active BOOLEAN DEFAULT TRUE,&#10;    notes TEXT COMMENT 'İşletme hakkında özel notlar',&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;&#10;    INDEX idx_business_code (business_code),&#10;    INDEX idx_name (name),&#10;    INDEX idx_phone (phone),&#10;    INDEX idx_business_type (business_type),&#10;    INDEX idx_is_active (is_active),&#10;    INDEX idx_location (latitude, longitude)&#10;);&#10;&#10;-- Orders tablosu (Siparişler/Paketler)&#10;CREATE TABLE orders (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    order_number VARCHAR(50) UNIQUE NOT NULL,&#10;    status ENUM('PENDING', 'ASSIGNED', 'PICKED_UP', 'IN_TRANSIT', 'DELIVERED', 'CANCELLED') DEFAULT 'PENDING',&#10;    priority ENUM('LOW', 'NORMAL', 'HIGH', 'URGENT') DEFAULT 'NORMAL',&#10;&#10;    -- İşletme bilgileri (sipariş veren)&#10;    business_id BIGINT NOT NULL,&#10;    business_contact_person VARCHAR(100),&#10;    business_phone VARCHAR(20),&#10;&#10;    -- Kurye ve koordinatör bilgileri&#10;    courier_id BIGINT,&#10;    coordinator_id BIGINT,&#10;&#10;    -- Son müşteri bilgileri (teslimat alacak kişi)&#10;    end_customer_name VARCHAR(100) NOT NULL COMMENT 'Teslimatı alacak kişi',&#10;    end_customer_phone VARCHAR(20) COMMENT 'Teslimatı alacak kişinin telefonu',&#10;&#10;    -- Alım lokasyonu (işletmeden)&#10;    pickup_address TEXT NOT NULL,&#10;    pickup_address_description TEXT COMMENT 'Alım adresi tarifi',&#10;    pickup_latitude DECIMAL(10, 8),&#10;    pickup_longitude DECIMAL(11, 8),&#10;    pickup_location_name VARCHAR(200),&#10;    pickup_contact_person VARCHAR(100) COMMENT 'Alım yerindeki irtibat kişisi',&#10;&#10;    -- Teslimat lokasyonu (son müşteriye)&#10;    delivery_address TEXT NOT NULL,&#10;    delivery_address_description TEXT COMMENT 'Teslimat adresi tarifi',&#10;    delivery_latitude DECIMAL(10, 8),&#10;    delivery_longitude DECIMAL(11, 8),&#10;    delivery_location_name VARCHAR(200),&#10;&#10;    -- Paket bilgileri&#10;    package_description VARCHAR(500) NOT NULL,&#10;    package_weight DECIMAL(8,2) COMMENT 'Paket ağırlığı (kg)',&#10;    package_count INT DEFAULT 1 COMMENT 'Paket adedi',&#10;    package_value DECIMAL(10,2) COMMENT 'Paket değeri (sigorta için)',&#10;&#10;    -- Ödeme bilgileri&#10;    payment_type ENUM('CASH', 'CARD', 'ONLINE', 'BUSINESS_ACCOUNT') DEFAULT 'BUSINESS_ACCOUNT',&#10;    delivery_fee DECIMAL(10,2) NOT NULL,&#10;    collection_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT 'Tahsil edilecek tutar (varsa)',&#10;&#10;    -- Notlar ve dökümanlar&#10;    courier_notes TEXT COMMENT 'Kuryeye özel notlar',&#10;    business_notes TEXT COMMENT 'İşletmenin notları',&#10;    receipt_image_url VARCHAR(500) COMMENT 'Fiş/Adisyon resmi URL',&#10;    delivery_proof_url VARCHAR(500) COMMENT 'Teslimat kanıtı resmi URL',&#10;&#10;    -- Zaman bilgileri&#10;    order_date DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'Sipariş tarihi',&#10;    scheduled_pickup_time DATETIME COMMENT 'Planlanan alım zamanı',&#10;    actual_pickup_time DATETIME COMMENT 'Gerçek alım zamanı',&#10;    estimated_delivery_time DATETIME COMMENT 'Tahmini teslimat zamanı',&#10;    actual_delivery_time DATETIME COMMENT 'Gerçek teslimat zamanı',&#10;&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,&#10;&#10;    FOREIGN KEY (business_id) REFERENCES businesses(id) ON DELETE RESTRICT,&#10;    FOREIGN KEY (courier_id) REFERENCES couriers(id) ON DELETE SET NULL,&#10;    FOREIGN KEY (coordinator_id) REFERENCES coordinators(id) ON DELETE SET NULL,&#10;&#10;    INDEX idx_order_number (order_number),&#10;    INDEX idx_status (status),&#10;    INDEX idx_priority (priority),&#10;    INDEX idx_business_id (business_id),&#10;    INDEX idx_courier_id (courier_id),&#10;    INDEX idx_coordinator_id (coordinator_id),&#10;    INDEX idx_order_date (order_date),&#10;    INDEX idx_scheduled_pickup (scheduled_pickup_time),&#10;    INDEX idx_estimated_delivery (estimated_delivery_time),&#10;    INDEX idx_payment_type (payment_type)&#10;);&#10;&#10;-- Order tracking tablosu (Sipariş takip geçmişi)&#10;CREATE TABLE order_tracking (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    order_id BIGINT NOT NULL,&#10;    status ENUM('PENDING', 'ASSIGNED', 'PICKED_UP', 'IN_TRANSIT', 'DELIVERED', 'CANCELLED') NOT NULL,&#10;    description VARCHAR(500),&#10;    location VARCHAR(200),&#10;    latitude DECIMAL(10, 8),&#10;    longitude DECIMAL(11, 8),&#10;    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,&#10;    created_by VARCHAR(100) COMMENT 'Durumu güncelleyen kişi (kurye adı, koordinatör veya sistem)',&#10;    created_by_type ENUM('SYSTEM', 'COURIER', 'COORDINATOR', 'ADMIN') DEFAULT 'SYSTEM',&#10;&#10;    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,&#10;    INDEX idx_order_id (order_id),&#10;    INDEX idx_status (status),&#10;    INDEX idx_created_at (created_at),&#10;    INDEX idx_location (latitude, longitude),&#10;    INDEX idx_created_by_type (created_by_type)&#10;);" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/db/migration/V2__Insert_initial_data.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/db/migration/V2__Insert_initial_data.sql" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="-- V2__Insert_initial_data.sql&#10;-- B2B Kurye servisi için örnek veriler&#10;&#10;-- Sistem kullanıcıları (Admin, Koordinatör, Kurye)&#10;INSERT INTO system_users (username, email, password, first_name, last_name, role, is_active) VALUES&#10;('admin', 'admin@courier.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi.', 'System', 'Admin', 'ADMIN', true),&#10;('coord1', 'ahmet.yilmaz@courier.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi.', 'Ahmet', 'Yılmaz', 'COORDINATOR', true),&#10;('coord2', 'ayse.demir@courier.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi.', 'Ayşe', 'Demir', 'COORDINATOR', true),&#10;('courier1', 'ali.ozkan@courier.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi.', 'Ali', 'Özkan', 'COURIER', true),&#10;('courier2', 'fatma.celik@courier.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi.', 'Fatma', 'Çelik', 'COURIER', true),&#10;('courier3', 'osman.acar@courier.com', '$2a$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2uheWG/igi.', 'Osman', 'Acar', 'COURIER', true);&#10;&#10;-- Örnek araçlar&#10;INSERT INTO vehicles (plate_number, vehicle_type, brand, model, year, color, max_weight_capacity, is_active) VALUES&#10;('34ABC123', 'MOTORCYCLE', 'Yamaha', 'NMAX', 2023, 'Siyah', 30.00, true),&#10;('34DEF456', 'MOTORCYCLE', 'Honda', 'PCX', 2022, 'Beyaz', 25.00, true),&#10;('34GHI789', 'CAR', 'Renault', 'Clio', 2021, 'Gri', 300.00, true),&#10;('BIKE001', 'BICYCLE', 'Bianchi', 'City', 2023, 'Mavi', 15.00, true),&#10;('34JKL012', 'VAN', 'Ford', 'Transit', 2020, 'Beyaz', 1000.00, true);&#10;&#10;-- Koordinatörler&#10;INSERT INTO coordinators (system_user_id, name, email, phone, employee_id, work_type, shift_start, shift_end, status, coverage_area, max_courier_count, is_active) VALUES&#10;(2, 'Ahmet Yılmaz', 'ahmet.yilmaz@courier.com', '+905551234567', 'COORD001', 'SHIFT', '09:00:00', '18:00:00', 'ONLINE', 'Kadıköy, Üsküdar, Ataşehir', 15, true),&#10;(3, 'Ayşe Demir', 'ayse.demir@courier.com', '+905551234568', 'COORD002', 'SHIFT', '18:00:00', '03:00:00', 'OFFLINE', 'Beşiktaş, Şişli, Beyoğlu', 12, true);&#10;&#10;-- Kuryeler (rating alanı kaldırıldı)&#10;INSERT INTO couriers (system_user_id, name, email, phone, license_number, vehicle_type, work_type, shift_start, shift_end, status, total_deliveries, vehicle_id, coordinator_id, is_available) VALUES&#10;(4, 'Ali Özkan', 'ali.ozkan@courier.com', '+905551111111', 'B123456', 'MOTORCYCLE', 'SHIFT', '09:00:00', '18:00:00', 'ONLINE', 150, 1, 1, true),&#10;(5, 'Fatma Çelik', 'fatma.celik@courier.com', '+905552222222', 'B234567', 'MOTORCYCLE', 'SHIFT', '09:00:00', '18:00:00', 'OFFLINE', 200, 2, 1, true),&#10;(6, 'Osman Acar', 'osman.acar@courier.com', '+905553333333', 'B345678', 'CAR', 'SHIFT', '18:00:00', '03:00:00', 'ONLINE', 120, 3, 2, true);&#10;&#10;-- İşletmeler (sipariş veren firmalar)&#10;INSERT INTO businesses (business_code, name, contact_person, phone, email, address, address_description, location_name, business_type, payment_terms, credit_limit, is_active, notes) VALUES&#10;('BUS001', 'Köşe Restoran', 'Mehmet Bey', '+902161234567', 'info@koserestoran.com', 'Kadıköy Mah. Moda Cad. No:15 Kadıköy/İstanbul', 'Moda Sahili yanında, yeşil tabelalı bina, arka kapıdan giriş', 'Kadıköy Moda', 'Restaurant', 'POSTPAID', 5000.00, true, 'Hızlı teslimat gerektiren restoran'),&#10;&#10;('BUS002', 'Pizza Palace Suadiye', 'Ayşe Hanım', '+902162345678', 'order@pizzapalace.com', 'Bağdat Cad. No:250 Suadiye/İstanbul', 'AVM karşısı, büyük pizza tabelası, araç park yeri var', 'Suadiye', 'Fast Food', 'PREPAID', 0.00, true, 'Günlük yoğun sipariş hacmi'),&#10;&#10;('BUS003', 'Market Plus Ataşehir', 'Hasan Usta', '+902163456789', 'info@marketplus.com', 'Ataşehir Bulvarı No:100 Ataşehir/İstanbul', 'Metro çıkışı, 24 saat açık market, yükleme alanı mevcut', 'Ataşehir Merkez', 'Market', 'POSTPAID', 10000.00, true, '24 saat sipariş alıyor'),&#10;&#10;('BUS004', 'Çiçek Dünyası Nişantaşı', 'Zeynep Hanım', '+902164567890', 'siparis@cicekdunyasi.com', 'Nişantaşı Cad. No:45 Şişli/İstanbul', 'Eski çiçekçiler çarşısı içinde, kırmızı tabela', 'Nişantaşı', 'Flower Shop', 'CASH_ON_DELIVERY', 2000.00, true, 'Özel günlerde yoğunluk artar'),&#10;&#10;('BUS005', 'Eczane Sağlık Beyoğlu', 'Doktor Ahmet', '+902165678901', 'info@eczanesaglik.com', 'İstiklal Cad. No:123 Beyoğlu/İstanbul', 'Galatasaray Lisesi yanı, yeşil haç tabelası, 7/24 açık', 'Beyoğlu İstiklal', 'Pharmacy', 'POSTPAID', 3000.00, true, 'Acil ilaç siparişleri alır');&#10;&#10;-- Örnek siparişler&#10;INSERT INTO orders (order_number, status, priority, business_id, business_contact_person, business_phone, courier_id, coordinator_id, end_customer_name, end_customer_phone, pickup_address, pickup_address_description, pickup_contact_person, delivery_address, delivery_address_description, package_description, package_weight, package_count, payment_type, delivery_fee, collection_amount, courier_notes, business_notes, scheduled_pickup_time, estimated_delivery_time, order_date) VALUES&#10;&#10;('ORD-2025080401', 'PENDING', 'NORMAL', 1, 'Mehmet Bey', '+902161234567', NULL, 1, 'Elif Yılmaz', '+905556666666', 'Kadıköy Mah. Moda Cad. No:15 Kadıköy/İstanbul', 'Moda Sahili yanında, yeşil tabelalı bina, arka kapıdan giriş', 'Mehmet Bey', 'Acıbadem Mah. Çeçen Sok. No:8 Kat:3 Üsküdar/İstanbul', 'Apartman zili çalışmıyor, telefon arayın, 3. kat daire 7', 'Pizza Margherita ve İçecek', 1.5, 1, 'CASH', 25.00, 45.50, 'Sıcak tutulmalı, ekstra soğuk içecek', 'Müşteri arayıp geldiğinde teslim et', '2025-08-04 19:30:00', '2025-08-04 20:15:00', '2025-08-04 19:00:00'),&#10;&#10;('ORD-2025080402', 'ASSIGNED', 'HIGH', 2, 'Ayşe Hanım', '+902162345678', 1, 1, 'Ahmet Kaya', '+905557777777', 'Bağdat Cad. No:250 Suadiye/İstanbul', 'AVM karşısı, büyük pizza tabelası, araç park yeri var', 'Ayşe Hanım', 'Levent Mah. Büyükdere Cad. No:200 Şişli/İstanbul', 'İş merkezinde, güvenlik kaydı gerekli, 15. kat Garanti Bankası', 'Büyük boy karışık pizza ve salata', 2.0, 1, 'BUSINESS_ACCOUNT', 35.00, 0.00, 'İş merkezine giriş için kimlik gerekli', 'Öğle molasında teslim edilmeli', '2025-08-04 20:00:00', '2025-08-04 21:00:00', '2025-08-04 19:45:00'),&#10;&#10;('ORD-2025080403', 'IN_TRANSIT', 'URGENT', 5, 'Doktor Ahmet', '+902165678901', 3, 2, 'Yaşlı Teyze', '+905558888888', 'İstiklal Cad. No:123 Beyoğlu/İstanbul', 'Galatasaray Lisesi yanı, yeşil haç tabelası, 7/24 açık', 'Doktor Ahmet', 'Fenerbahçe Mah. Bağdat Cad. No:300 Kat:1 Kadıköy/İstanbul', 'Kapıcı var, apartman no: 5, yaşlı teyze tek başına', 'Acil ilaç paketi - Kalp ilacı', 0.3, 1, 'CASH', 15.00, 125.00, 'Acil ilaç, hızlı teslimat gerekli, para tahsil edilecek', 'Kalp hastası için acil, gecikme olmasın', '2025-08-04 18:45:00', '2025-08-04 19:30:00', '2025-08-04 18:30:00');&#10;&#10;-- Sipariş takip kayıtları&#10;INSERT INTO order_tracking (order_id, status, description, created_by, created_by_type) VALUES&#10;(1, 'PENDING', 'Sipariş alındı, kurye ataması bekleniyor', 'SISTEM', 'SYSTEM'),&#10;(2, 'PENDING', 'Sipariş alındı', 'SISTEM', 'SYSTEM'),&#10;(2, 'ASSIGNED', 'Ali Özkan kuryesine atandı', 'Ahmet Yılmaz', 'COORDINATOR'),&#10;(3, 'PENDING', 'Acil sipariş alındı', 'SISTEM', 'SYSTEM'),&#10;(3, 'ASSIGNED', 'Osman Acar kuryesine atandı', 'Ayşe Demir', 'COORDINATOR'),&#10;(3, 'PICKED_UP', 'Paket eczaneden alındı', 'Osman Acar', 'COURIER'),&#10;(3, 'IN_TRANSIT', 'Teslimat adresine doğru yola çıkıldı', 'Osman Acar', 'COURIER');" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>