-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;

-- Ensure PostGIS extension is available before creating geometry columns
CREATE EXTENSION IF NOT EXISTS postgis;

-- Sequence creation for all tables
CREATE SEQUENCE IF NOT EXISTS businesses_business_id_seq;
CREATE SEQUENCE IF NOT EXISTS courrier_courrier_id_seq;
CREATE SEQUENCE IF NOT EXISTS courrier_location_history_id_seq;
CREATE SEQUENCE IF NOT EXISTS deliveries_delivery_id_seq;
CREATE SEQUENCE IF NOT EXISTS ratings_rating_id_seq;
CREATE SEQUENCE IF NOT EXISTS routes_route_id_seq;
CREATE SEQUENCE IF NOT EXISTS shifts_shift_id_seq;
CREATE SEQUENCE IF NOT EXISTS zones_zone_id_seq;

DROP TABLE IF EXISTS public.businesses;

CREATE TABLE IF NOT EXISTS public.businesses
(
    business_id integer NOT NULL DEFAULT nextval('businesses_business_id_seq'::regclass),
    name character varying(150) COLLATE pg_catalog."default" NOT NULL,
    contact_person character varying(100) COLLATE pg_catalog."default",
    phone_number character varying(20) COLLATE pg_catalog."default" NOT NULL,
    address_line_1 character varying(255) COLLATE pg_catalog."default" NOT NULL,
    registered_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT businesses_pkey PRIMARY KEY (business_id),
    CONSTRAINT businesses_phone_number_key UNIQUE (phone_number)
);

DROP TABLE IF EXISTS public.courrier;

CREATE TABLE IF NOT EXISTS public.courrier
(
    courrier_id integer NOT NULL DEFAULT nextval('courrier_courrier_id_seq'::regclass),
    full_name character varying(100) COLLATE pg_catalog."default" NOT NULL,
    phone_number character varying(20) COLLATE pg_catalog."default" NOT NULL,
    status character varying(20) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Offline'::character varying,
    registration_date timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    vehicle_type character varying(20) COLLATE pg_catalog."default",
    working_model character varying(50) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Shift'::character varying,
    on_duty_since timestamp with time zone,
    zone_id integer,
    current_location geometry(Point,4326),
    is_in_zone boolean DEFAULT true,
    CONSTRAINT courrier_pkey PRIMARY KEY (courrier_id),
    CONSTRAINT courrier_phone_number_key UNIQUE (phone_number)
);

DROP TABLE IF EXISTS public.courrier_location_history;

CREATE TABLE IF NOT EXISTS public.courrier_location_history
(
    id integer NOT NULL DEFAULT nextval('courrier_location_history_id_seq'::regclass),
    courrier_id integer,
    location geometry(Point,4326) NOT NULL,
    recorded_at timestamp without time zone DEFAULT now(),
    CONSTRAINT courrier_location_history_pkey PRIMARY KEY (id)
);

DROP TABLE IF EXISTS public.deliveries;

CREATE TABLE IF NOT EXISTS public.deliveries
(
    delivery_id integer NOT NULL DEFAULT nextval('deliveries_delivery_id_seq'::regclass),
    business_id integer NOT NULL,
    courrier_id integer,
    item_type character varying(50) COLLATE pg_catalog."default" NOT NULL,
    item_description text COLLATE pg_catalog."default",
    weight_kg numeric(5, 2),
    pickup_address character varying(255) COLLATE pg_catalog."default" NOT NULL,
    dropoff_address character varying(255) COLLATE pg_catalog."default" NOT NULL,
    status character varying(50) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Pending'::character varying,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    assigned_at timestamp with time zone,
    picked_up_at timestamp with time zone,
    delivered_at timestamp with time zone,
    route_id integer,
    CONSTRAINT deliveries_pkey PRIMARY KEY (delivery_id)
);

DROP TABLE IF EXISTS public.ratings;

CREATE TABLE IF NOT EXISTS public.ratings
(
    rating_id integer NOT NULL DEFAULT nextval('ratings_rating_id_seq'::regclass),
    courrier_id integer NOT NULL,
    entity_type character varying(50) COLLATE pg_catalog."default" NOT NULL,
    entity_id integer NOT NULL,
    score integer NOT NULL,
    comment text COLLATE pg_catalog."default",
    rated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT ratings_pkey PRIMARY KEY (rating_id)
);

DROP TABLE IF EXISTS public.routes;

CREATE TABLE IF NOT EXISTS public.routes
(
    route_id integer NOT NULL DEFAULT nextval('routes_route_id_seq'::regclass),
    courrier_id integer,
    route_status character varying(50) COLLATE pg_catalog."default" DEFAULT 'Created'::character varying,
    CONSTRAINT routes_pkey PRIMARY KEY (route_id)
);

DROP TABLE IF EXISTS public.shifts;

CREATE TABLE IF NOT EXISTS public.shifts
(
    shift_id integer NOT NULL DEFAULT nextval('shifts_shift_id_seq'::regclass),
    courrier_id integer NOT NULL,
    start_time timestamp with time zone NOT NULL,
    end_time timestamp with time zone NOT NULL,
    shift_type character varying(50) COLLATE pg_catalog."default" DEFAULT 'Normal'::character varying,
    shift_role character varying(50) COLLATE pg_catalog."default" NOT NULL DEFAULT 'Courrier'::character varying,
    CONSTRAINT shifts_pkey PRIMARY KEY (shift_id)
);


DROP TABLE IF EXISTS public.zones;

CREATE TABLE IF NOT EXISTS public.zones
(
    zone_id integer NOT NULL DEFAULT nextval('zones_zone_id_seq'::regclass),
    name character varying(100) COLLATE pg_catalog."default" NOT NULL,
    description text COLLATE pg_catalog."default",
    area geometry(Polygon,4326) NOT NULL,
    created_at timestamp without time zone DEFAULT now(),
    CONSTRAINT zones_pkey PRIMARY KEY (zone_id),
    CONSTRAINT zones_name_key UNIQUE (name)
);
END;